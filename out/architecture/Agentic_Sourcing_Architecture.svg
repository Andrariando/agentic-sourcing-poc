<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2712px" preserveAspectRatio="none" style="width:3626px;height:2712px;background:#FEFEFE;" version="1.1" viewBox="0 0 3626 2712" width="3626px" zoomAndPan="magnify"><defs><filter height="300%" id="f1y6hy3w155ia" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="240" x="1686.5" y="11.4189">Agentic Sourcing Copilot - Enterprise Architecture</text><text fill="#000000" font-family="sans-serif" font-size="11" font-style="italic" lengthAdjust="spacing" textLength="281" x="1666" y="25.2549">Human-in-the-Loop Multi-Agent Decision Support System</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="0" x="1808" y="39.0908"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="133" x="1631.5" y="52.9268">Current Implementation</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="214" x="1767.5" y="52.9268">— LLM-First Classification &amp; Artifact System</text><!--MD5=[4c275c90aa705310e0149fa934b9dd18]
cluster **FRONTEND** - Streamlit UI--><path d="M11,380.3438 L135,380.3438 A7.5,7.5 0 0 1 140,385.3438 L147,400.1797 L503,400.1797 A5,5 0 0 1 508,405.1797 L508,741.8438 A5,5 0 0 1 503,746.8438 L11,746.8438 A5,5 0 0 1 6,741.8438 L6,385.3438 A5,5 0 0 1 11,380.3438 " fill="#FEFEFE" filter="url(#f1y6hy3w155ia)" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="6" x2="147" y1="400.1797" y2="400.1797"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="55" x="10" y="393.7627">FRONTEND</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="70" x="68" y="393.7627">- Streamlit UI</text><text fill="#000000" font-family="sans-serif" font-size="11" font-style="italic" lengthAdjust="spacing" textLength="52" x="235" y="413.5986">«frontend»</text><!--MD5=[9ac15a0cf91036a266899d8638101d30]
cluster **BACKEND** - FastAPI Server--><path d="M537,548.3438 L674,548.3438 A7.5,7.5 0 0 1 679,553.3438 L686,568.1797 L2571,568.1797 A5,5 0 0 1 2576,573.1797 L2576,2201.8438 A5,5 0 0 1 2571,2206.8438 L537,2206.8438 A5,5 0 0 1 532,2201.8438 L532,553.3438 A5,5 0 0 1 537,548.3438 " fill="#FEFEFE" filter="url(#f1y6hy3w155ia)" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="532" x2="686" y1="568.1797" y2="568.1797"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="50" x="536" y="561.7627">BACKEND</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="88" x="589" y="561.7627">- FastAPI Server</text><text fill="#000000" font-family="sans-serif" font-size="11" font-style="italic" lengthAdjust="spacing" textLength="55" x="1530.5" y="581.5986">«backend»</text><!--MD5=[8c6f3eb1e022e81ddcb8dd81e44e8cb0]
cluster **Services Layer**--><path d="M1907,1057.3438 L1985,1057.3438 A7.5,7.5 0 0 1 1990,1062.3438 L1997,1077.1797 L2228,1077.1797 A5,5 0 0 1 2233,1082.1797 L2233,1618.8438 A5,5 0 0 1 2228,1623.8438 L1907,1623.8438 A5,5 0 0 1 1902,1618.8438 L1902,1062.3438 A5,5 0 0 1 1907,1057.3438 " fill="#FEFEFE" filter="url(#f1y6hy3w155ia)" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="1902" x2="1997" y1="1077.1797" y2="1077.1797"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="82" x="1906" y="1070.7627">Services Layer</text><!--MD5=[3de3d5543dc291a4255e037d5ae25fa2]
cluster **SUPERVISOR** - Central Orchestrator--><path d="M1972,602.3438 L2159,602.3438 A7.5,7.5 0 0 1 2164,607.3438 L2171,622.1797 L2267,622.1797 A5,5 0 0 1 2272,627.1797 L2272,965.3438 A5,5 0 0 1 2267,970.3438 L1972,970.3438 A5,5 0 0 1 1967,965.3438 L1967,607.3438 A5,5 0 0 1 1972,602.3438 " fill="#FEFEFE" filter="url(#f1y6hy3w155ia)" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="1967" x2="2171" y1="622.1797" y2="622.1797"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="67" x="1971" y="615.7627">SUPERVISOR</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="121" x="2041" y="615.7627">- Central Orchestrator</text><text fill="#000000" font-family="sans-serif" font-size="11" font-style="italic" lengthAdjust="spacing" textLength="64" x="2091.5" y="635.5986">«supervisor»</text><!--MD5=[1a199e9c8f2ac4c206e7c8e7db9c8715]
cluster **7 OFFICIAL AGENTS**--><path d="M820,1267.3438 L920,1267.3438 A7.5,7.5 0 0 1 925,1272.3438 L932,1287.1797 L1783,1287.1797 A5,5 0 0 1 1788,1292.1797 L1788,1399.3438 A5,5 0 0 1 1783,1404.3438 L820,1404.3438 A5,5 0 0 1 815,1399.3438 L815,1272.3438 A5,5 0 0 1 820,1267.3438 " fill="#FEFEFE" filter="url(#f1y6hy3w155ia)" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="815" x2="932" y1="1287.1797" y2="1287.1797"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="104" x="819" y="1280.7627">7 OFFICIAL AGENTS</text><text fill="#000000" font-family="sans-serif" font-size="11" font-style="italic" lengthAdjust="spacing" textLength="39" x="1286" y="1300.5986">«agent»</text><!--MD5=[4fc4e5993e795f06bb4192b1b07c81cf]
cluster **TASK EXECUTION LAYER**--><path d="M1721,1493.3438 L1846,1493.3438 A7.5,7.5 0 0 1 1851,1498.3438 L1858,1513.1797 L1873,1513.1797 A5,5 0 0 1 1878,1518.1797 L1878,2177.8438 A5,5 0 0 1 1873,2182.8438 L1721,2182.8438 A5,5 0 0 1 1716,2177.8438 L1716,1498.3438 A5,5 0 0 1 1721,1493.3438 " fill="#FEFEFE" filter="url(#f1y6hy3w155ia)" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="1716" x2="1858" y1="1513.1797" y2="1513.1797"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="129" x="1720" y="1506.7627">TASK EXECUTION LAYER</text><text fill="#000000" font-family="sans-serif" font-size="11" font-style="italic" lengthAdjust="spacing" textLength="33" x="1784.5" y="1526.5986">«task»</text><!--MD5=[3e48907bd97ade0542b67fae3325eb92]
cluster **ARTIFACT SYSTEM**--><path d="M1078,1500.8438 L1175,1500.8438 A7.5,7.5 0 0 1 1180,1505.8438 L1187,1520.6797 L1240,1520.6797 A5,5 0 0 1 1245,1525.6797 L1245,1821.3438 A5,5 0 0 1 1240,1826.3438 L1078,1826.3438 A5,5 0 0 1 1073,1821.3438 L1073,1505.8438 A5,5 0 0 1 1078,1500.8438 " fill="#FEFEFE" filter="url(#f1y6hy3w155ia)" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="1073" x2="1187" y1="1520.6797" y2="1520.6797"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="101" x="1077" y="1514.2627">ARTIFACT SYSTEM</text><!--MD5=[8f149d3ff5a29feaeca4735ddec664bc]
cluster **RAG LAYER**--><path d="M2327,1921.8438 L2384,1921.8438 A7.5,7.5 0 0 1 2389,1926.8438 L2396,1941.6797 L2467,1941.6797 A5,5 0 0 1 2472,1946.6797 L2472,2170.8438 A5,5 0 0 1 2467,2175.8438 L2327,2175.8438 A5,5 0 0 1 2322,2170.8438 L2322,1926.8438 A5,5 0 0 1 2327,1921.8438 " fill="#FEFEFE" filter="url(#f1y6hy3w155ia)" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="2322" x2="2396" y1="1941.6797" y2="1941.6797"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="61" x="2326" y="1935.2627">RAG LAYER</text><!--MD5=[103796216b7f31ff20ade2d8b3e0865b]
cluster **INGESTION LAYER**--><path d="M2262,1287.8438 L2352,1287.8438 A7.5,7.5 0 0 1 2357,1292.8438 L2364,1307.6797 L2547,1307.6797 A5,5 0 0 1 2552,1312.6797 L2552,1392.8438 A5,5 0 0 1 2547,1397.8438 L2262,1397.8438 A5,5 0 0 1 2257,1392.8438 L2257,1292.8438 A5,5 0 0 1 2262,1287.8438 " fill="#FEFEFE" filter="url(#f1y6hy3w155ia)" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="2257" x2="2364" y1="1307.6797" y2="1307.6797"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="94" x="2261" y="1301.2627">INGESTION LAYER</text><!--MD5=[88f919cc70c6e2f8b4a45820d743cff8]
cluster **DATA LAYER** - Persistence--><path d="M2908,2267.8438 L3049,2267.8438 A7.5,7.5 0 0 1 3054,2272.8438 L3061,2287.6797 L3406,2287.6797 A5,5 0 0 1 3411,2292.6797 L3411,2441.8438 A5,5 0 0 1 3406,2446.8438 L2908,2446.8438 A5,5 0 0 1 2903,2441.8438 L2903,2272.8438 A5,5 0 0 1 2908,2267.8438 " fill="#FEFEFE" filter="url(#f1y6hy3w155ia)" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="2903" x2="3061" y1="2287.6797" y2="2287.6797"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="68" x="2907" y="2281.2627">DATA LAYER</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="74" x="2978" y="2281.2627">- Persistence</text><text fill="#000000" font-family="sans-serif" font-size="11" font-style="italic" lengthAdjust="spacing" textLength="33" x="3144.5" y="2301.0986">«data»</text><!--MD5=[4b4aa12fd50f56bd13a7a0170aaccc36]
entity dashboard--><rect fill="#FEFECE" filter="url(#f1y6hy3w155ia)" height="61.5078" rx="5" ry="5" style="stroke:#000000;stroke-width:2.0;" width="124" x="22" y="432.8438"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="11" x="32" y="454.2627">&#128202;</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="90" x="46" y="454.2627">Case Dashboard</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="85" x="32" y="468.0986">Case list, metrics,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="98" x="32" y="481.9346">filtering, status view</text><!--MD5=[4af8dce8cff07d067cf4221318aaa363]
entity copilot--><rect fill="#FEFECE" filter="url(#f1y6hy3w155ia)" height="75.3438" rx="5" ry="5" style="stroke:#000000;stroke-width:2.0;" width="104" x="388" y="426.3438"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="11" x="398" y="447.7627">&#128172;</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="70" x="412" y="447.7627">Case Copilot</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="71" x="398" y="461.5986">Chat interface,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="74" x="398" y="475.4346">artifact display,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="43" x="398" y="489.2705">audit trail</text><!--MD5=[87ce26710ac76f4f5901bc8fd9789d9e]
entity knowledge--><rect fill="#FEFECE" filter="url(#f1y6hy3w155ia)" height="61.5078" rx="5" ry="5" style="stroke:#000000;stroke-width:2.0;" width="171" x="181.5" y="432.8438"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="11" x="191.5" y="454.2627">&#128193;</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="137" x="205.5" y="454.2627">Knowledge Management</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="86" x="191.5" y="468.0986">Document upload,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="67" x="191.5" y="481.9346">data ingestion</text><!--MD5=[6be96040792a0cd556c535244c12ec70]
entity api_client--><rect fill="#FEFECE" filter="url(#f1y6hy3w155ia)" height="61.5078" rx="5" ry="5" style="stroke:#000000;stroke-width:2.0;" width="148" x="280" y="668.8438"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="11" x="290" y="690.2627">&#128268;</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="53" x="304" y="690.2627">API Client</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="128" x="290" y="704.0986">HTTP/REST communication</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="79" x="290" y="717.9346">or Direct imports</text><!--MD5=[e2307af040e3f87d22824e7603ca28ec]
entity api--><rect fill="#FEFECE" filter="url(#f1y6hy3w155ia)" height="61.5078" rx="5" ry="5" style="stroke:#000000;stroke-width:2.0;" width="141" x="1714.5" y="885.8438"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="11" x="1724.5" y="907.2627">&#127760;</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="48" x="1738.5" y="907.2627">REST API</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="121" x="1724.5" y="921.0986">/cases, /chat, /decisions,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="70" x="1724.5" y="934.9346">/ingest, /health</text><!--MD5=[789e23807450d0f32381ad58adade5f0]
entity chat_svc--><rect fill="#FEFECE" filter="url(#f1y6hy3w155ia)" height="103.0156" rx="5" ry="5" style="stroke:#000000;stroke-width:2.0;" width="134" x="1918" y="1089.3438"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="11" x="1928" y="1110.7627">&#128172;</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="69" x="1942" y="1110.7627">Chat Service</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="104" x="1928" y="1124.5986">Message processing,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="72" x="1928" y="1138.4346">intent handling,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="97" x="1928" y="1152.2705">response formatting</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="114" x="1928" y="1166.1064">+ Conversation memory</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="82" x="1928" y="1179.9424">+ Cost estimation</text><!--MD5=[fcf377f22f7879951f7f547416a5ec68]
entity conv_mgr--><rect fill="#FEFECE" filter="url(#f1y6hy3w155ia)" height="89.1797" rx="5" ry="5" style="stroke:#000000;stroke-width:2.0;" width="146" x="2064" y="1306.3438"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="126" x="2074" y="1327.7627">&#128190; **Conversation Context</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="50" x="2074" y="1341.5986">Manager**</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="82" x="2074" y="1355.4346">Context retrieval,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="87" x="2074" y="1369.2705">message storage,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="103" x="2074" y="1383.1064">cost-aware selection</text><!--MD5=[252e12d2df198ece75d7fc8077b9d9d4]
entity case_svc--><rect fill="#FEFECE" filter="url(#f1y6hy3w155ia)" height="75.3438" rx="5" ry="5" style="stroke:#000000;stroke-width:2.0;" width="121" x="2043.5" y="1532.8438"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="11" x="2053.5" y="1554.2627">&#128203;</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="72" x="2067.5" y="1554.2627">Case Service</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="59" x="2053.5" y="1568.0986">Case CRUD,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="101" x="2053.5" y="1581.9346">artifact management,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="84" x="2053.5" y="1595.7705">state persistence</text><!--MD5=[c302a21b22525181f366f2bd9dea10ca]
entity ingest_svc--><rect fill="#FEFECE" filter="url(#f1y6hy3w155ia)" height="61.5078" rx="5" ry="5" style="stroke:#000000;stroke-width:2.0;" width="130" x="2087" y="1109.8438"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="11" x="2097" y="1131.2627">&#128229;</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="96" x="2111" y="1131.2627">Ingestion Service</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="103" x="2097" y="1145.0986">Upload orchestration,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="45" x="2097" y="1158.9346">validation</text><!--MD5=[7342edd9a184d8607391f4c130efbf01]
entity router--><rect fill="#FEFECE" filter="url(#f1y6hy3w155ia)" height="103.0156" rx="5" ry="5" style="stroke:#000000;stroke-width:2.0;" width="207" x="2048.5" y="648.3438"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="8" x="2058.5" y="669.7627">&#129504;</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="72" x="2069.5" y="669.7627">Intent Router</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="115" x="2058.5" y="683.5986">LLM-First Classification:</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="187" x="2058.5" y="697.4346">• LLM with structured output (primary)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="172" x="2058.5" y="711.2705">• Aggressive caching (500 entries)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="135" x="2058.5" y="725.1064">• Rule fallback (errors only)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="169" x="2058.5" y="738.9424">• Two-level (UserGoal+WorkType)</text><!--MD5=[203532b68035934a929f249a5fd26f91]
entity state_mgr--><rect fill="#FEFECE" filter="url(#f1y6hy3w155ia)" height="75.3438" rx="5" ry="5" style="stroke:#000000;stroke-width:2.0;" width="124" x="2132" y="879.3438"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="11" x="2142" y="900.7627">&#128202;</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="79" x="2156" y="900.7627">State Manager</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="93" x="2142" y="914.5986">DTP stage tracking,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="104" x="2142" y="928.4346">validation, transitions,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="88" x="2142" y="942.2705">ONLY state writer</text><!--MD5=[75390d3fefe5b03c70cb446d957a6395]
entity planner--><rect fill="#FEFECE" filter="url(#f1y6hy3w155ia)" height="61.5078" rx="5" ry="5" style="stroke:#000000;stroke-width:2.0;" width="114" x="1983" y="885.8438"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="11" x="1993" y="907.2627">&#128203;</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="80" x="2007" y="907.2627">Action Planner</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="78" x="1993" y="921.0986">Agent selection,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="63" x="1993" y="934.9346">task planning</text><!--MD5=[0cd6d143226e0aa5e0d21836b7b0a6b9]
entity signal_agent--><rect fill="#FEFECE" filter="url(#f1y6hy3w155ia)" height="75.3438" rx="5" ry="5" style="stroke:#000000;stroke-width:2.0;" width="119" x="1338.5" y="1313.3438"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="11" x="1348.5" y="1334.7627">&#128225;</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="85" x="1362.5" y="1334.7627">Sourcing Signal</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="43" x="1348.5" y="1348.5986">(DTP-01)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="79" x="1348.5" y="1362.4346">Signal detection,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="79" x="1348.5" y="1376.2705">urgency scoring</text><!--MD5=[38d537fee585efdef8f1c38976a87a4e]
entity supplier_agent--><rect fill="#FEFECE" filter="url(#f1y6hy3w155ia)" height="75.3438" rx="5" ry="5" style="stroke:#000000;stroke-width:2.0;" width="123" x="1492.5" y="1313.3438"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="9" x="1502.5" y="1334.7627">⭐</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="91" x="1514.5" y="1334.7627">Supplier Scoring</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="43" x="1502.5" y="1348.5986">(DTP-02)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="93" x="1502.5" y="1362.4346">Evaluation, ranking,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="77" x="1502.5" y="1376.2705">eligibility checks</text><!--MD5=[2e2995ad3460f19375202185c2494efe]
entity rfx_agent--><rect fill="#FEFECE" filter="url(#f1y6hy3w155ia)" height="61.5078" rx="5" ry="5" style="stroke:#000000;stroke-width:2.0;" width="130" x="1173" y="1319.8438"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="11" x="1183" y="1341.2627">&#128221;</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="48" x="1197" y="1341.2627">RFx Draft</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="43" x="1183" y="1355.0986">(DTP-03)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="110" x="1183" y="1368.9346">RFI/RFP/RFQ assembly</text><!--MD5=[74e2ddb0a0f069b766dc019571ca4d61]
entity negotiation_agent--><rect fill="#FEFECE" filter="url(#f1y6hy3w155ia)" height="75.3438" rx="5" ry="5" style="stroke:#000000;stroke-width:2.0;" width="143" x="994.5" y="1313.3438"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="11" x="1004.5" y="1334.7627">&#129309;</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="109" x="1018.5" y="1334.7627">Negotiation Support</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="43" x="1004.5" y="1348.5986">(DTP-04)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="92" x="1004.5" y="1362.4346">Leverage analysis,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="83" x="1004.5" y="1376.2705">targets, playbook</text><!--MD5=[ccf4e69e9afbd78ce1de2289ef8f24ff]
entity contract_agent--><rect fill="#FEFECE" filter="url(#f1y6hy3w155ia)" height="75.3438" rx="5" ry="5" style="stroke:#000000;stroke-width:2.0;" width="128" x="831" y="1313.3438"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="11" x="841" y="1334.7627">&#128196;</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="94" x="855" y="1334.7627">Contract Support</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="43" x="841" y="1348.5986">(DTP-05)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="78" x="841" y="1362.4346">Term extraction,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="89" x="841" y="1376.2705">validation, handoff</text><!--MD5=[a6af673e7c9d46cd5b69a9a1146c0c0c]
entity impl_agent--><rect fill="#FEFECE" filter="url(#f1y6hy3w155ia)" height="75.3438" rx="5" ry="5" style="stroke:#000000;stroke-width:2.0;" width="121" x="1650.5" y="1313.3438"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="11" x="1660.5" y="1334.7627">&#128640;</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="87" x="1674.5" y="1334.7627">Implementation</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="43" x="1660.5" y="1348.5986">(DTP-06)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="78" x="1660.5" y="1362.4346">Rollout planning,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="66" x="1660.5" y="1376.2705">value capture</text><!--MD5=[a69ffa393f4828dd55768dd05a07bdd7]
entity task_rules--><rect fill="#FEFECE" filter="url(#f1y6hy3w155ia)" height="61.5078" rx="5" ry="5" style="stroke:#000000;stroke-width:2.0;" width="122" x="1735" y="1539.3438"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="14" x="1745" y="1560.7627">1️⃣</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="31" x="1762" y="1560.7627">Rules</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="102" x="1745" y="1574.5986">Deterministic checks,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="76" x="1745" y="1588.4346">policy validation</text><!--MD5=[e6562574f0672370c29c27bdece53b46]
entity task_retrieval--><rect fill="#FEFECE" filter="url(#f1y6hy3w155ia)" height="61.5078" rx="5" ry="5" style="stroke:#000000;stroke-width:2.0;" width="115" x="1744.5" y="1741.8438"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="14" x="1754.5" y="1763.2627">2️⃣</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="48" x="1771.5" y="1763.2627">Retrieval</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="95" x="1754.5" y="1777.0986">ChromaDB + SQLite</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="82" x="1754.5" y="1790.9346">query, grounding</text><!--MD5=[2a857a500a5a28ae0250c040aafd948c]
entity task_analytics--><rect fill="#FEFECE" filter="url(#f1y6hy3w155ia)" height="61.5078" rx="5" ry="5" style="stroke:#000000;stroke-width:2.0;" width="129" x="1732.5" y="1953.8438"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="14" x="1742.5" y="1975.2627">3️⃣</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="50" x="1759.5" y="1975.2627">Analytics</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="109" x="1742.5" y="1989.0986">Scoring, normalization,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="97" x="1742.5" y="2002.9346">comparison, ranking</text><!--MD5=[a01003f875e5153ce9664344efeb5900]
entity task_llm--><rect fill="#FEFECE" filter="url(#f1y6hy3w155ia)" height="61.5078" rx="5" ry="5" style="stroke:#000000;stroke-width:2.0;" width="122" x="1733" y="2104.8438"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="14" x="1743" y="2126.2627">4️⃣</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="24" x="1760" y="2126.2627">LLM</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="102" x="1743" y="2140.0986">Narration, summaries</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="80" x="1743" y="2153.9346">(last resort only)</text><!--MD5=[6d140ca06fa3e705ccff803348b39241]
entity artifact_builder--><rect fill="#FEFECE" filter="url(#f1y6hy3w155ia)" height="75.3438" rx="5" ry="5" style="stroke:#000000;stroke-width:2.0;" width="125" x="1096.5" y="1735.3438"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="11" x="1106.5" y="1756.7627">&#128230;</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="82" x="1120.5" y="1756.7627">Artifact Builder</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="68" x="1106.5" y="1770.5986">Pack creation,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="89" x="1106.5" y="1784.4346">verification status,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="105" x="1106.5" y="1798.2705">grounding references</text><!--MD5=[09b6c84ea678f301e5c93c4a867bdcc0]
entity exec_metadata--><rect fill="#FEFECE" filter="url(#f1y6hy3w155ia)" height="75.3438" rx="5" ry="5" style="stroke:#000000;stroke-width:2.0;" width="140" x="1089" y="1532.8438"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="11" x="1099" y="1554.2627">&#128202;</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="106" x="1113" y="1554.2627">Execution Metadata</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="71" x="1099" y="1568.0986">Tokens, costs,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="57" x="1099" y="1581.9346">task details,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="82" x="1099" y="1595.7705">retrieval sources</text><!--MD5=[200b716258823f6794d107a60a287b95]
entity retriever--><rect fill="#FEFECE" filter="url(#f1y6hy3w155ia)" height="61.5078" rx="5" ry="5" style="stroke:#000000;stroke-width:2.0;" width="104" x="2338" y="1953.8438"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="11" x="2348" y="1975.2627">&#128269;</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="51" x="2362" y="1975.2627">Retriever</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="84" x="2348" y="1989.0986">Semantic search,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="68" x="2348" y="2002.9346">metadata filter</text><!--MD5=[264d3d63eb61e1fd66af9e1f62e9323f]
entity vector_store--><rect fill="#FEFECE" filter="url(#f1y6hy3w155ia)" height="47.6719" rx="5" ry="5" style="stroke:#000000;stroke-width:2.0;" width="116" x="2340" y="2111.8438"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="11" x="2350" y="2133.2627">&#128230;</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="70" x="2364" y="2133.2627">Vector Store</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="96" x="2350" y="2147.0986">ChromaDB wrapper</text><!--MD5=[2a2950fbda473123fd240cac98ab0d09]
entity doc_ingest--><rect fill="#FEFECE" filter="url(#f1y6hy3w155ia)" height="61.5078" rx="5" ry="5" style="stroke:#000000;stroke-width:2.0;" width="116" x="2420" y="1319.8438"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="11" x="2430" y="1341.2627">&#128196;</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="58" x="2444" y="1341.2627">Doc Ingest</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="79" x="2430" y="1355.0986">PDF, DOCX, TXT</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="96" x="2430" y="1368.9346">→ chunks → embed</text><!--MD5=[041600926ccb4e61c3a8a25e56a6d9c6]
entity data_ingest--><rect fill="#FEFECE" filter="url(#f1y6hy3w155ia)" height="61.5078" rx="5" ry="5" style="stroke:#000000;stroke-width:2.0;" width="111" x="2273.5" y="1319.8438"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="11" x="2283.5" y="1341.2627">&#128202;</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="61" x="2297.5" y="1341.2627">Data Ingest</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="54" x="2283.5" y="1355.0986">CSV, Excel</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="91" x="2283.5" y="1368.9346">→ validate → store</text><!--MD5=[7a603111606425ec6ae263a7f93634a1]
entity sqlite--><rect fill="#FEFECE" filter="url(#f1y6hy3w155ia)" height="116.8516" rx="5" ry="5" style="stroke:#000000;stroke-width:2.0;" width="145" x="3093.5" y="2313.8438"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="17" x="3103.5" y="2335.2627">&#128452;️</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="36" x="3123.5" y="2335.2627">SQLite</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="48" x="3103.5" y="2349.0986">Data Lake</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="41" x="3103.5" y="2362.9346">• Cases</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="75" x="3103.5" y="2376.7705">• ArtifactPacks</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="82" x="3103.5" y="2390.6064">• ChatMessages</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="104" x="3103.5" y="2404.4424">• Execution Metadata</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="125" x="3103.5" y="2418.2783">• Suppliers, Spend, SLAs</text><!--MD5=[517a3f92df6edbb3e5cf89f46e19ead8]
entity chromadb--><rect fill="#FEFECE" filter="url(#f1y6hy3w155ia)" height="75.3438" rx="5" ry="5" style="stroke:#000000;stroke-width:2.0;" width="139" x="2919.5" y="2334.8438"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="8" x="2929.5" y="2356.2627">&#129522;</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="58" x="2940.5" y="2356.2627">ChromaDB</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="62" x="2929.5" y="2370.0986">Vector Store</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="119" x="2929.5" y="2383.9346">• Document embeddings</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="91" x="2929.5" y="2397.7705">• Semantic search</text><!--MD5=[82f23cda116f7491e2ad662b9686858a]
entity files--><rect fill="#FEFECE" filter="url(#f1y6hy3w155ia)" height="61.5078" rx="5" ry="5" style="stroke:#000000;stroke-width:2.0;" width="121" x="3273.5" y="2341.3438"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="11" x="3283.5" y="2362.7627">&#128193;</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="26" x="3297.5" y="2362.7627">Files</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="101" x="3283.5" y="2376.5986">Uploaded documents</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="90" x="3283.5" y="2390.4346">Synthetic test data</text><!--MD5=[576713d34b70cd01e0fe64aa18bc23e4]
entity human--><rect fill="#FFEBEE" filter="url(#f1y6hy3w155ia)" height="61.5078" rx="5" ry="5" style="stroke:#C62828;stroke-width:2.0;" width="147" x="242.5" y="229.3438"/><text fill="#000000" font-family="sans-serif" font-size="11" font-style="italic" lengthAdjust="spacing" textLength="45" x="293.5" y="250.7627">«human»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="11" x="252.5" y="264.5986">&#128100;</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="113" x="266.5" y="264.5986">Procurement Officer</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="118" x="252.5" y="278.4346">(Human Decision-Maker)</text><!--MD5=[363cc6da13d8bcdcb0851ce1cf6e8377]
entity llm--><rect fill="#E8E8E8" filter="url(#f1y6hy3w155ia)" height="61.5078" rx="5" ry="5" style="stroke:#999999;stroke-width:2.0;" width="109" x="736.5" y="2341.3438"/><text fill="#000000" font-family="sans-serif" font-size="11" font-style="italic" lengthAdjust="spacing" textLength="52" x="765" y="2362.7627">«external»</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="11" x="746.5" y="2376.5986">&#129302;</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="75" x="760.5" y="2376.5986">OpenAI GPT-4</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="71" x="746.5" y="2390.4346">(LLM Provider)</text><path d="M2592.5,637.3438 L2592.5,695.8438 L2255.78,699.8438 L2592.5,703.8438 L2592.5,761.8672 A5,5 0 0 0 2597.5,766.8672 L2858.5,766.8672 A5,5 0 0 0 2863.5,761.8672 L2863.5,642.3438 L2853.5,632.3438 L2597.5,632.3438 A5,5 0 0 0 2592.5,637.3438 " fill="#FBFB77" filter="url(#f1y6hy3w155ia)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M2853.5,632.3438 L2853.5,639.8438 A2.5,2.5 0 0 0 2856,642.3438 L2863.5,642.3438 L2853.5,632.3438 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="165" x="2598.5" y="648.7627">LLM-First Intent Classification</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="186" x="2598.5" y="662.5986">━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="169" x="2598.5" y="676.4346">1. LLM classification (primary path)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="189" x="2598.5" y="690.2705">2. Structured output (Pydantic schema)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="174" x="2598.5" y="704.1064">3. Aggressive caching (500 entries)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="172" x="2598.5" y="717.9424">4. Two-level: UserGoal + WorkType</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="250" x="2598.5" y="731.7783">5. Context-aware (DTP stage, conversation history)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="137" x="2598.5" y="745.6143">6. Rule fallback (errors only)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="155" x="2598.5" y="759.4502">7. Few-shot examples in prompt</text><path d="M2834.5,1717.3438 L2834.5,1828.0313 A5,5 0 0 0 2839.5,1833.0313 L3036.5,1833.0313 A5,5 0 0 0 3041.5,1828.0313 L3041.5,1722.3438 L3031.5,1712.3438 L2839.5,1712.3438 A5,5 0 0 0 2834.5,1717.3438 " fill="#FBFB77" filter="url(#f1y6hy3w155ia)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3031.5,1712.3438 L3031.5,1719.8438 A2.5,2.5 0 0 0 3034,1722.3438 L3041.5,1722.3438 L3031.5,1712.3438 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="138" x="2840.5" y="1728.7627">Task Execution Hierarchy</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="186" x="2840.5" y="1742.5986">━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="142" x="2840.5" y="1756.4346">All agents follow same order:</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="110" x="2840.5" y="1770.2705">1. Rules (deterministic)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="134" x="2840.5" y="1784.1064">2. Retrieval (ground in data)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="111" x="2840.5" y="1797.9424">3. Analytics (calculate)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="101" x="2840.5" y="1811.7783">4. LLM (narrate only)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="101" x="2840.5" y="1825.6143">⚠️ Never skip steps</text><path d="M2592.5,861.3438 L2592.5,972.0313 A5,5 0 0 0 2597.5,977.0313 L2794.5,977.0313 A5,5 0 0 0 2799.5,972.0313 L2799.5,866.3438 L2789.5,856.3438 L2597.5,856.3438 A5,5 0 0 0 2592.5,861.3438 " fill="#FBFB77" filter="url(#f1y6hy3w155ia)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M2789.5,856.3438 L2789.5,863.8438 A2.5,2.5 0 0 0 2792,866.3438 L2799.5,866.3438 L2789.5,856.3438 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="130" x="2598.5" y="872.7627">Supervisor Governance</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="186" x="2598.5" y="886.5986">━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="150" x="2598.5" y="900.4346">• ONLY component that writes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="51" x="2604.5" y="914.2705">case state</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="121" x="2598.5" y="928.1064">• Validates all transitions</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="134" x="2598.5" y="941.9424">• Enforces human approval</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="128" x="2598.5" y="955.7783">• Blocks invalid DTP jumps</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="92" x="2598.5" y="969.6143">• Logs all changes</text><path d="M2592.5,1703.8438 L2592.5,1842.2031 A5,5 0 0 0 2597.5,1847.2031 L2794.5,1847.2031 A5,5 0 0 0 2799.5,1842.2031 L2799.5,1708.8438 L2789.5,1698.8438 L2597.5,1698.8438 A5,5 0 0 0 2592.5,1703.8438 " fill="#FBFB77" filter="url(#f1y6hy3w155ia)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M2789.5,1698.8438 L2789.5,1706.3438 A2.5,2.5 0 0 0 2792,1708.8438 L2799.5,1708.8438 L2789.5,1698.8438 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="85" x="2598.5" y="1715.2627">Artifact System</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="186" x="2598.5" y="1729.0986">━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="137" x="2598.5" y="1742.9346">• ArtifactPacks with multiple</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="40" x="2604.5" y="1756.7705">artifacts</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="152" x="2598.5" y="1770.6064">• Verification status (VERIFIED/</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="108" x="2604.5" y="1784.4424">PARTIAL/UNVERIFIED)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="117" x="2598.5" y="1798.2783">• Grounding references</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="146" x="2598.5" y="1812.1143">• Execution metadata (tokens,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="91" x="2604.5" y="1825.9502">costs, task details)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="72" x="2598.5" y="1839.7861">• Full audit trail</text><path d="M2592.5,1288.3438 L2592.5,1412.8672 A5,5 0 0 0 2597.5,1417.8672 L2794.5,1417.8672 A5,5 0 0 0 2799.5,1412.8672 L2799.5,1293.3438 L2789.5,1283.3438 L2597.5,1283.3438 A5,5 0 0 0 2592.5,1288.3438 " fill="#FBFB77" filter="url(#f1y6hy3w155ia)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M2789.5,1283.3438 L2789.5,1290.8438 A2.5,2.5 0 0 0 2792,1293.3438 L2799.5,1293.3438 L2789.5,1283.3438 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="123" x="2598.5" y="1299.7627">Conversation Memory</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="87" x="2598.5" y="1313.5986">(Optional Feature)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="186" x="2598.5" y="1327.4346">━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="105" x="2598.5" y="1341.2705">• Enabled via env var</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="153" x="2598.5" y="1355.1064">• Cost-aware context selection</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="152" x="2598.5" y="1368.9424">• Pre-execution cost estimation</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="161" x="2598.5" y="1382.7783">• Backward compatible (disabled</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="52" x="2604.5" y="1396.6143">by default)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="155" x="2598.5" y="1410.4502">• Messages persist in database</text><path d="M212.5,66.3438 L212.5,163.1953 A5,5 0 0 0 217.5,168.1953 L312,168.1953 L316,229.2638 L320,168.1953 L414.5,168.1953 A5,5 0 0 0 419.5,163.1953 L419.5,71.3438 L409.5,61.3438 L217.5,61.3438 A5,5 0 0 0 212.5,66.3438 " fill="#FBFB77" filter="url(#f1y6hy3w155ia)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M409.5,61.3438 L409.5,68.8438 A2.5,2.5 0 0 0 412,71.3438 L419.5,71.3438 L409.5,61.3438 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="106" x="218.5" y="77.7627">Human-in-the-Loop</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="186" x="218.5" y="91.5986">━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="146" x="218.5" y="105.4346">✅ Approve → Advance stage</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="141" x="218.5" y="119.2705">✏️ Edit → Modify &amp; resubmit</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="124" x="218.5" y="133.1064">❌ Reject → Stay at stage</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="0" x="221.5" y="146.9424"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="131" x="218.5" y="160.7783">AI advises, Human decides</text><!--MD5=[be91230b1f798049f038b9378dd1c98d]
link human to copilot--><path d="M334.56,291.5138 C355.86,326.1138 390.89,383.0437 414.68,421.6937 " fill="none" id="human-to-copilot" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="417.52,426.3138,416.2189,416.5512,414.9035,422.053,409.4017,420.7376,417.52,426.3138" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="78" x="383.5" y="340.7627">Asks questions,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="87" x="379" y="354.5986">Approves/Rejects</text><!--MD5=[5ea3f2550e3ee438cfa310b4849842cc]
link copilot to human--><path d="M464.14,426.2137 C480.86,395.7838 496.59,352.5637 475,321.3438 C456.6,294.7337 424.8,279.9138 394.45,271.6638 " fill="none" id="copilot-to-human" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="389.59,270.3938,397.2962,276.5268,394.4296,271.65,399.3063,268.7834,389.59,270.3938" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="91" x="487" y="333.7627">Recommendations,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="88" x="488.5" y="347.5986">Evidence, Pending</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="44" x="510.5" y="361.4346">Approval</text><!--MD5=[c206d04f5c05282be3b9082ddffebc94]
link human to dashboard--><path d="M242.12,277.6337 C213.65,286.7838 182.39,300.6537 159,321.3438 C126.68,349.9338 105.98,395.8638 94.69,427.6038 " fill="none" id="human-to-dashboard" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="92.96,432.5738,99.6989,425.3913,94.6054,427.8522,92.1445,422.7587,92.96,432.5738" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="68" x="160" y="340.7627">Views cases,</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="62" x="163" y="354.5986">selects case</text><!--MD5=[2d46e724c441994b3943421d562ace59]
link human to knowledge--><path d="M268.44,291.4637 C258.96,299.8938 250.3,309.9237 245,321.3438 C229.27,355.2337 239.59,398.1138 250.8,427.7338 " fill="none" id="human-to-knowledge" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="252.75,432.7338,253.2204,422.8961,250.9398,428.0729,245.763,425.7924,252.75,432.7338" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="95" x="246" y="340.7627">Uploads documents</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="54" x="266.5" y="354.5986">&amp; data files</text><!--MD5=[7f8e824fe9aa7994c2e2d6c4b588942a]
link dashboard to api_client--><path d="M118.75,494.9537 C169.13,538.6238 262.21,619.2938 314.92,664.9738 " fill="none" id="dashboard-to-api_client" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="318.96,668.4738,314.7824,659.5548,315.183,665.1975,309.5403,665.5981,318.96,668.4738" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[a530ac22912fc87b597c3c1d0d86ddc6]
link copilot to api_client--><path d="M426.56,501.4037 C410.28,545.7137 383.03,619.8538 366.96,663.5738 " fill="none" id="copilot-to-api_client" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="365.15,668.4938,372.0177,661.4344,366.8805,663.8028,364.5121,658.6656,365.15,668.4938" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[d87dbe85e23d88c743093ac364526ad0]
link knowledge to api_client--><path d="M278.2,494.9537 C294.27,538.1837 323.82,617.6837 340.89,663.5938 " fill="none" id="knowledge-to-api_client" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="342.71,668.4738,343.3215,658.6439,340.9669,663.7874,335.8234,661.4328,342.71,668.4738" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[e4218dc8576b5f4727381931811678d0]
link api_client to api--><path d="M428.42,712.0238 C674.57,749.0038 1460.79,867.1338 1709.09,904.4437 " fill="none" id="api_client-to-api" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1714.14,905.1937,1705.8344,899.9006,1709.1955,904.4507,1704.6455,907.8117,1714.14,905.1937" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="70" x="1160.5" y="809.7627">REST API calls</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="79" x="1156" y="823.5986">or Direct imports</text><!--MD5=[a036f675a3f9fa022f781fbacfeb422f]
link api to case_svc--><path d="M1770.27,947.9137 C1741.55,1011.3838 1686.72,1160.6238 1757,1251.3438 C1765.71,1262.5938 1775.61,1252.3438 1788,1259.3438 C1912.57,1329.7138 2023.07,1461.6638 2074.09,1528.4338 " fill="none" id="api-to-case_svc" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="2077.37,1532.7337,2075.0932,1523.1517,2074.3381,1528.7579,2068.7318,1528.0028,2077.37,1532.7337" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="56" x="1758" y="1241.7627">Case CRUD</text><!--MD5=[34b35cf27b79f55eb3f87c4269c791a5]
link api to chat_svc--><path d="M1786.86,948.0238 C1790.38,976.8638 1800.44,1019.1238 1829,1041.3438 C1843.97,1052.9938 1897.35,1040.2538 1914,1049.3438 C1929.41,1057.7538 1942.61,1071.0638 1953.3,1084.9038 " fill="none" id="api-to-chat_svc" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1956.53,1089.2138,1954.33,1079.6138,1953.53,1085.2138,1947.93,1084.4138,1956.53,1089.2138" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="75" x="1830" y="1029.2627">Chat messages</text><!--MD5=[98ddd2b50bfd18f9b858b5fdb48551ea]
link api to ingest_svc--><path d="M1855.72,945.4637 C1889.01,957.3938 1929.54,970.4038 1967,978.3438 C2032.31,992.1837 2221.13,957.9137 2266,1007.3438 C2296.27,1040.6938 2253.13,1079.9038 2211.53,1106.9738 " fill="none" id="api-to-ingest_svc" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="2207.25,1109.7138,2216.9859,1108.2267,2211.4601,1107.0165,2212.6703,1101.4906,2207.25,1109.7138" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="57" x="2277" y="1029.2627">File uploads</text><!--MD5=[bea09dea38a14a3a4a71b2625c02a584]
link chat_svc to router--><path d="M2019.73,1089.3438 C2033.41,1073.5938 2050.53,1058.0838 2070,1049.3438 C2084.96,1042.6338 2353.57,1053.0938 2365,1041.3438 C2450.3,953.7037 2318.73,826.3238 2227.43,754.7938 " fill="none" id="chat_svc-to-router" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="2223.38,751.6438,2228.0219,760.3301,2227.3245,754.7164,2232.9381,754.019,2223.38,751.6438" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="70" x="2393" y="914.7627">User message</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="45" x="2405.5" y="928.5986">+ context</text><!--MD5=[a002d5a47346dcc4c939bf650a561910]
link router to state_mgr--><path d="M2161.9,751.5238 C2169.2,788.9137 2179.02,839.1737 2185.87,874.2238 " fill="none" id="router-to-state_mgr" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="2186.86,879.2838,2189.0656,869.685,2185.9041,874.376,2181.2132,871.2144,2186.86,879.2838" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="45" x="2178" y="809.7627">Validates</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="49" x="2176" y="823.5986">DTP stage</text><!--MD5=[fc3b8b9163cc87155d5579adec3990e2]
link router to planner--><path d="M2112.73,751.3538 C2102.58,765.7438 2092.21,781.7438 2084,797.3438 C2069.87,824.1737 2058.18,856.5638 2050.4,880.6937 " fill="none" id="router-to-planner" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="2048.81,885.7137,2055.3514,878.351,2050.3266,880.9493,2047.7283,875.9245,2048.81,885.7137" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="77" x="2085" y="809.7627">Two-level intent</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="67" x="2090" y="823.5986">→ Action Plan</text><!--MD5=[5a5284d5cd3ddfdefc1ea6ecb5db0fef]
link planner to chat_svc--><path d="M2013.52,947.9537 C2003.39,958.3938 1991.3,969.6438 1979,978.3438 C1954.82,995.4537 1934.74,982.2538 1919,1007.3438 C1910.97,1020.1438 1914.6,1026.8838 1919,1041.3438 C1923.57,1056.3838 1931.29,1071.2138 1939.87,1084.6238 " fill="none" id="planner-to-chat_svc" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1942.81,1089.1138,1941.2228,1079.3936,1940.0695,1084.9317,1934.5315,1083.7784,1942.81,1089.1138" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="70" x="1920" y="1029.2627">Agent + Tasks</text><!--MD5=[26b4aa7942397f83941634b651e9e9c8]
link chat_svc to signal_agent--><path d="M1917.82,1144.1038 C1791.65,1149.6138 1525.52,1167.5538 1454,1222.3438 C1426.97,1243.0538 1412.73,1279.5738 1405.39,1308.2338 " fill="none" id="chat_svc-to-signal_agent" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1404.18,1313.1238,1410.2003,1305.3291,1405.3658,1308.2664,1402.4285,1303.4319,1404.18,1313.1238" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="38" x="1474" y="1234.7627">DTP-01:</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="76" x="1455" y="1248.5986">Signal detection</text><!--MD5=[790fe956f73270b284081bad409f2225]
link chat_svc to supplier_agent--><path d="M1917.99,1180.1338 C1897.27,1192.8138 1874.72,1207.4938 1855,1222.3438 C1839.67,1233.8838 1840.76,1244.0638 1823,1251.3438 C1783.9,1267.3738 1671.1,1241.0538 1633,1259.3438 C1610.63,1270.0838 1591.98,1290.3938 1578.44,1309.0538 " fill="none" id="chat_svc-to-supplier_agent" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1575.45,1313.2638,1583.9177,1308.2341,1578.3413,1309.1845,1577.3909,1303.608,1575.45,1313.2638" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="38" x="1876" y="1234.7627">DTP-02:</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="78" x="1856" y="1248.5986">Supplier scoring</text><!--MD5=[a2f7feb1f54c3b7f363cea3f8fd777ae]
link chat_svc to rfx_agent--><path d="M1917.82,1145.2438 C1777.4,1153.1838 1457.7,1175.9138 1360,1222.3438 C1317.14,1242.7138 1281.49,1285.1038 1260.01,1315.4138 " fill="none" id="chat_svc-to-rfx_agent" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1256.94,1319.7938,1265.3793,1314.7165,1259.8083,1315.6983,1258.8265,1310.1273,1256.94,1319.7938" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="38" x="1371.5" y="1234.7627">DTP-03:</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="59" x="1361" y="1248.5986">RFx drafting</text><!--MD5=[3949901e9e66e03116a57fa966d1a22c]
link chat_svc to negotiation_agent--><path d="M1917.96,1145.1038 C1755.83,1153.5838 1346.36,1178.7838 1217,1222.3438 C1169.08,1238.4838 1126.29,1278.2938 1098.6,1309.1838 " fill="none" id="chat_svc-to-negotiation_agent" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1094.96,1313.2838,1103.9212,1309.1975,1098.2747,1309.5404,1097.9318,1303.894,1094.96,1313.2838" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="38" x="1245.5" y="1234.7627">DTP-04:</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="93" x="1218" y="1248.5986">Negotiation support</text><!--MD5=[f6ed7feefbf401a9e56c9760c6e49598]
link chat_svc to contract_agent--><path d="M1917.92,1144.8838 C1733.96,1153.6538 1224.43,1181.0838 1062,1222.3438 C1022.07,1232.4838 1010.47,1235.3138 977,1259.3438 C957.95,1273.0238 940.05,1291.7738 925.86,1308.6738 " fill="none" id="chat_svc-to-contract_agent" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="922.34,1312.9238,931.1554,1308.5318,925.524,1309.0686,924.9872,1303.4373,922.34,1312.9238" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="38" x="1090" y="1234.7627">DTP-05:</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="92" x="1063" y="1248.5986">Contract extraction</text><!--MD5=[cb406067b9c1c40a6f6cd73292aca573]
link chat_svc to impl_agent--><path d="M1976.74,1192.6038 C1970.77,1213.6838 1960.54,1236.6138 1943,1251.3438 C1928.78,1263.2838 1919.64,1253.5438 1902,1259.3438 C1858.8,1273.5438 1812.66,1295.2038 1776.56,1313.7738 " fill="none" id="chat_svc-to-impl_agent" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1771.75,1316.2638,1781.5814,1315.6784,1776.1903,1313.9651,1777.9036,1308.5739,1771.75,1316.2638" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="38" x="2002.5" y="1234.7627">DTP-06:</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="113" x="1965" y="1248.5986">Implementation planning</text><!--MD5=[943f2ad30c56fcc303801e409762ca26]
link signal_agent to task_rules--><path d="M1394.5,1388.4238 C1393.98,1417.2938 1398.67,1456.1238 1424,1477.3438 C1436.1,1487.4837 1693.43,1479.2638 1708,1485.3438 C1732.83,1495.7038 1754.73,1516.5438 1770.48,1534.8738 " fill="none" id="signal_agent-to-task_rules" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1773.94,1538.9837,1771.1959,1529.5249,1770.7167,1535.1614,1765.0802,1534.6822,1773.94,1538.9837" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="39" x="1425" y="1467.7627">1. Rules</text><!--MD5=[74dc2fe558412cde636bbbc096127532]
link supplier_agent to task_rules--><path d="M1567.27,1388.3538 C1579.93,1417.5938 1602.02,1456.9638 1635,1477.3438 C1662.77,1494.4938 1678.41,1471.5738 1708,1485.3438 C1732.21,1496.6138 1753.97,1517.2438 1769.8,1535.2337 " fill="none" id="supplier_agent-to-task_rules" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1773.29,1539.2638,1770.4319,1529.8387,1770.0208,1535.4806,1764.3789,1535.0694,1773.29,1539.2638" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="39" x="1636" y="1467.7627">1. Rules</text><!--MD5=[363da34cf2c605117de3e8ee9d7ae014]
link rfx_agent to task_rules--><path d="M1220.36,1381.9938 C1206.26,1410.4838 1192.52,1452.4638 1217,1477.3438 C1226.57,1487.0638 1695.38,1480.1638 1708,1485.3438 C1733.07,1495.6238 1755.11,1516.7038 1770.87,1535.1638 " fill="none" id="rfx_agent-to-task_rules" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1774.33,1539.3038,1771.6239,1529.8339,1771.1221,1535.4685,1765.4875,1534.9666,1774.33,1539.3038" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="39" x="1218" y="1467.7627">1. Rules</text><!--MD5=[0672238f0ec3be0568f7224f0fd4cc5a]
link negotiation_agent to task_rules--><path d="M1045.68,1388.4638 C1033.12,1416.5738 1023.28,1454.3538 1046,1477.3438 C1058.93,1490.4238 1690.97,1478.4038 1708,1485.3438 C1733.09,1495.5738 1755.14,1516.6438 1770.88,1535.1238 " fill="none" id="negotiation_agent-to-task_rules" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1774.35,1539.2737,1771.6473,1529.803,1771.1434,1535.4373,1765.5091,1534.9335,1774.35,1539.2737" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="39" x="1047" y="1467.7627">1. Rules</text><!--MD5=[c8349f64da31b1c95125ca3f7e3a20b5]
link contract_agent to task_rules--><path d="M858.57,1388.5938 C835.7,1416.0238 814.73,1452.8538 839,1477.3438 C855.99,1494.4938 1685.63,1476.2638 1708,1485.3438 C1733.11,1495.5338 1755.15,1516.6138 1770.9,1535.1038 " fill="none" id="contract_agent-to-task_rules" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1774.36,1539.2438,1771.6539,1529.7739,1771.1521,1535.4085,1765.5175,1534.9066,1774.36,1539.2438" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="39" x="840" y="1467.7627">1. Rules</text><!--MD5=[7ec6ff4238f333e44f3a72eb21b522ef]
link impl_agent to task_rules--><path d="M1746.69,1388.5038 C1756.19,1398.2238 1766.47,1408.7038 1776,1418.3438 C1789.26,1431.7538 1798.78,1430.9238 1806,1448.3438 C1817.34,1475.7337 1813.21,1509.5438 1807.17,1534.4538 " fill="none" id="impl_agent-to-task_rules" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1805.95,1539.3138,1812.0403,1531.5737,1807.1795,1534.4673,1804.2859,1529.6065,1805.95,1539.3138" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="39" x="1813" y="1467.7627">1. Rules</text><!--MD5=[7756119cb20828552dac7118d9281ef1]
link task_rules to task_retrieval--><path d="M1796.9,1601.3638 C1797.98,1637.5338 1799.8,1698.2238 1800.95,1736.5938 " fill="none" id="task_rules-to-task_retrieval" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1801.1,1741.6238,1804.8413,1732.5132,1800.9572,1736.6258,1796.8446,1732.7417,1801.1,1741.6238" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="54" x="1799" y="1659.2627">2. Retrieval</text><!--MD5=[7d487bcbef6fca2d9b4667b77b661824]
link task_retrieval to task_analytics--><path d="M1801.28,1803.9338 C1800.37,1842.1338 1798.81,1907.9538 1797.84,1948.5037 " fill="none" id="task_retrieval-to-task_analytics" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1797.72,1953.8138,1801.9246,1944.9075,1797.8343,1948.8151,1793.9267,1944.7247,1797.72,1953.8138" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="57" x="1800" y="1896.2627">3. Analytics</text><!--MD5=[17d9e8f0180cdfb514eb0354be40ea4d]
link task_analytics to task_llm--><path d="M1796.39,2015.9938 C1795.91,2040.1338 1795.22,2074.0238 1794.71,2099.4438 " fill="none" id="task_analytics-to-task_llm" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1794.61,2104.7338,1798.7892,2095.8155,1794.71,2099.7347,1790.7908,2095.6556,1794.61,2104.7338" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="32" x="1806.5" y="2058.2627">4. LLM</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="53" x="1796" y="2072.0986">(if needed)</text><!--MD5=[86a09605554f2a283bfd8ab2523b3c31]
link task_retrieval to retriever--><path d="M1859.72,1794.4538 C1972.48,1834.7337 2220.8,1923.4138 2332.99,1963.4837 " fill="none" id="task_retrieval-to-retriever" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="2337.9,1965.2337,2330.754,1958.4562,2333.1874,1963.5629,2328.0807,1965.9963,2337.9,1965.2337" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="86" x="2166" y="1896.2627">Query documents</text><!--MD5=[4c07ac76b67010bc8c59d67f89b66646]
link retriever to vector_store--><path d="M2386.5,2015.9738 C2385.03,2033.2438 2384.06,2055.2938 2386,2074.8438 C2387.03,2085.2838 2389.06,2096.6038 2391.15,2106.5638 " fill="none" id="retriever-to-vector_store" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="2392.25,2111.6438,2394.2562,2102.0014,2391.1926,2106.7568,2386.4371,2103.6932,2392.25,2111.6438" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="81" x="2387" y="2065.2627">Semantic search</text><!--MD5=[d6f5dd3331d9fa0a83a7de4e40d8a450]
link vector_store to chromadb--><path d="M2432.12,2159.9538 C2470.6,2185.2138 2535.68,2225.5738 2596,2251.8438 C2703,2298.4438 2833.81,2334.2938 2914.25,2354.1038 " fill="none" id="vector_store-to-chromadb" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="2919.48,2355.3838,2911.6854,2349.3635,2914.6226,2354.198,2909.7881,2357.1353,2919.48,2355.3838" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="64" x="2597" y="2242.2627">Vector query</text><!--MD5=[09184bf0eeb39c321957df8e7ae1fdb8]
link task_retrieval to sqlite--><path d="M1859.86,1778.2438 C1978.85,1788.9138 2257.79,1822.3938 2472,1913.8438 C2716.33,2018.1538 2714.23,2164.1338 2965,2251.8438 C2988.34,2260.0138 3054.08,2248.3838 3076,2259.8438 C3097.62,2271.1538 3115.89,2290.1638 3130.19,2309.3138 " fill="none" id="task_retrieval-to-sqlite" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="3133.37,2313.6538,3131.2689,2304.0316,3130.4113,2309.6231,3124.8199,2308.7655,3133.37,2313.6538" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="107" x="2708" y="2058.2627">Query structured data</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="123" x="2700" y="2072.0986">(Suppliers, Spend, SLAs)</text><!--MD5=[d5d0ef5c4e0ad0a9025ef2e536d94e80]
link signal_agent to artifact_builder--><path d="M1398.09,1388.4338 C1397.36,1420.9238 1394.06,1465.1038 1382,1477.3438 C1364.36,1495.2537 1345.86,1469.9238 1326,1485.3438 C1256.27,1539.4638 1296.75,1593.9638 1250,1668.8438 C1236.14,1691.0438 1217.44,1713.1338 1200.61,1731.1338 " fill="none" id="signal_agent-to-artifact_builder" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1196.82,1735.1438,1205.9011,1731.3314,1200.2468,1731.5028,1200.0755,1725.8485,1196.82,1735.1438" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="85" x="1327" y="1575.2627">Build ArtifactPack</text><!--MD5=[45395fb76d71e463a82c669ea3a1ffc6]
link supplier_agent to artifact_builder--><path d="M1572.4,1388.3738 C1587.33,1420.5838 1604.09,1464.3338 1592,1477.3438 C1575.47,1495.1338 1502.9,1471.4238 1483,1485.3438 C1424.48,1526.2737 1465.6,1579.5138 1417,1631.8438 C1364.38,1688.5037 1283.5,1727.1838 1226.34,1749.2838 " fill="none" id="supplier_agent-to-artifact_builder" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1221.58,1751.1138,1231.4168,1751.6002,1226.2438,1749.3112,1228.5327,1744.1381,1221.58,1751.1138" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="85" x="1484" y="1575.2627">Build ArtifactPack</text><!--MD5=[5cd3f1ea2b51fdd97bb02e3366e378ca]
link rfx_agent to artifact_builder--><path d="M1204.35,1382.1138 C1189.81,1394.2938 1172.21,1407.9038 1155,1418.3438 C1126.76,1435.4838 1114.09,1429.4438 1087,1448.3438 C1072.31,1458.5938 1075.09,1469.4638 1059,1477.3438 C1044.14,1484.6138 996.05,1473.0338 985,1485.3438 C941.5,1533.7938 956.88,1573.1238 985,1631.8438 C1007.13,1678.0438 1052.77,1713.8538 1091.75,1737.6838 " fill="none" id="rfx_agent-to-artifact_builder" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1096.47,1740.5338,1090.8422,1732.4512,1092.1927,1737.9445,1086.6994,1739.2949,1096.47,1740.5338" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="85" x="986" y="1575.2627">Build ArtifactPack</text><!--MD5=[79529a643adf47bff4716adad7b5b25d]
link negotiation_agent to artifact_builder--><path d="M1023.15,1388.4938 C1009.1,1399.2038 992.99,1410.2038 977,1418.3438 C936.78,1438.8138 914.25,1418.9638 880,1448.3438 C826.34,1494.3738 857.81,1625.2337 862,1631.8438 C912.16,1710.9438 1020.28,1746.1738 1091.29,1761.2737 " fill="none" id="negotiation_agent-to-artifact_builder" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1096.34,1762.3238,1088.341,1756.5778,1091.4444,1761.3074,1086.7148,1764.4108,1096.34,1762.3238" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="85" x="863" y="1575.2627">Build ArtifactPack</text><!--MD5=[c218177ccb6628251a4db4a73a8e60f8]
link contract_agent to artifact_builder--><path d="M830.73,1359.4238 C756.95,1371.7038 648.41,1402.6438 668,1477.3438 C687.99,1553.5738 694.64,1581.1738 755,1631.8438 C853.8,1714.7938 1004.64,1749.6338 1091.33,1763.4638 " fill="none" id="contract_agent-to-artifact_builder" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1096.44,1764.2638,1088.1645,1758.9238,1091.4998,1763.4927,1086.9308,1766.8281,1096.44,1764.2638" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="85" x="756" y="1575.2627">Build ArtifactPack</text><!--MD5=[abe8e97fd0fdfb604b97a3c7f8007f3d]
link impl_agent to artifact_builder--><path d="M1749.47,1388.5738 C1764.21,1405.2438 1779.32,1426.1738 1787,1448.3438 C1791.22,1460.5237 1795.88,1468.0037 1787,1477.3438 C1774.89,1490.0838 1643.19,1474.9738 1629,1485.3438 C1572.85,1526.3838 1624,1583.5037 1574,1631.8438 C1477.69,1724.9538 1317.41,1756.2138 1226.8,1766.6538 " fill="none" id="impl_agent-to-artifact_builder" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1221.74,1767.2238,1231.1295,1770.1965,1226.7089,1766.6669,1230.2385,1762.2463,1221.74,1767.2238" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="85" x="1630" y="1575.2627">Build ArtifactPack</text><!--MD5=[8418438e9197051364b81f2dfd8f71ff]
link signal_agent to exec_metadata--><path d="M1361.24,1388.4138 C1335.19,1413.9338 1299.12,1448.4438 1266,1477.3438 C1261.71,1481.0838 1260.37,1481.7038 1256,1485.3438 C1239.11,1499.4038 1220.84,1515.0938 1204.75,1529.0838 " fill="none" id="signal_agent-to-exec_metadata" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1200.71,1532.6038,1210.1235,1529.7077,1204.48,1529.3193,1204.8684,1523.6758,1200.71,1532.6038" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="77" x="1296" y="1467.7627">Track execution</text><!--MD5=[8ec05112213d8a630edfe053e66999d9]
link supplier_agent to exec_metadata--><path d="M1541.35,1388.3838 C1528.95,1418.0638 1506.92,1458.0438 1473,1477.3438 C1452.03,1489.2737 1278.45,1476.5037 1256,1485.3438 C1232.49,1494.6038 1210.77,1512.1438 1193.87,1528.8138 " fill="none" id="supplier_agent-to-exec_metadata" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1190.12,1532.5838,1199.3052,1529.0297,1193.6484,1529.0411,1193.637,1523.3842,1190.12,1532.5838" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="77" x="1507" y="1467.7627">Track execution</text><!--MD5=[699d83423aab89724b3349ad4a927386]
link rfx_agent to exec_metadata--><path d="M1203,1381.9438 C1188.54,1393.8338 1171.36,1407.2638 1155,1418.3438 C1132.59,1433.5238 1115.63,1424.9638 1102,1448.3438 C1086.91,1474.2238 1101.51,1504.7638 1119.71,1528.6738 " fill="none" id="rfx_agent-to-exec_metadata" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1122.9,1532.7638,1120.5248,1523.2056,1119.8273,1528.8193,1114.2136,1528.1219,1122.9,1532.7638" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="77" x="1103" y="1467.7627">Track execution</text><!--MD5=[1926e273fc9461be6bae5781ebc90307]
link negotiation_agent to exec_metadata--><path d="M1022.43,1388.3538 C1008.49,1398.9338 992.6,1409.8938 977,1418.3438 C942.87,1436.8238 917.23,1416.5338 895,1448.3438 C887.62,1458.9038 886.11,1468.0138 895,1477.3438 C907.82,1490.7938 1044.75,1478.4438 1062,1485.3438 C1085.46,1494.7337 1107.17,1512.2938 1124.08,1528.9338 " fill="none" id="negotiation_agent-to-exec_metadata" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1127.83,1532.6938,1124.313,1523.4942,1124.3016,1529.1511,1118.6448,1529.1397,1127.83,1532.6938" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="77" x="896" y="1467.7627">Track execution</text><!--MD5=[b29ea8b4fd529741db15abbc98a9a783]
link contract_agent to exec_metadata--><path d="M830.83,1365.7138 C752.51,1385.3238 636.48,1424.7138 688,1477.3438 C702.54,1492.1938 1042.61,1477.8738 1062,1485.3438 C1085.58,1494.4238 1107.31,1511.9438 1124.19,1528.6438 " fill="none" id="contract_agent-to-exec_metadata" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1127.94,1532.4238,1124.4602,1523.2101,1124.426,1528.8669,1118.7692,1528.8326,1127.94,1532.4238" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="77" x="689" y="1467.7627">Track execution</text><!--MD5=[0dbe83fbee8aa1ccfc4128decd9f9248]
link impl_agent to exec_metadata--><path d="M1712.98,1388.3538 C1712.35,1417.3838 1706.13,1456.4837 1680,1477.3438 C1661.59,1492.0438 1278,1476.9038 1256,1485.3438 C1232.22,1494.4638 1210.33,1512.2038 1193.38,1529.0338 " fill="none" id="impl_agent-to-exec_metadata" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1189.62,1532.8338,1198.7908,1529.2426,1193.134,1529.2769,1193.0998,1523.6201,1189.62,1532.8338" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="77" x="1701" y="1467.7627">Track execution</text><!--MD5=[9e6f65f499346533f1426e40386c1f68]
link artifact_builder to chat_svc--><path d="M1096.28,1764.3738 C930.5,1741.5938 499.87,1661.1038 597,1448.3438 C650.25,1331.6938 700.49,1317.0538 815,1259.3438 C1008.88,1161.6438 1688.27,1145.1838 1912.55,1142.4038 " fill="none" id="artifact_builder-to-chat_svc" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1917.76,1142.3438,1908.7149,1138.4469,1912.7603,1142.4009,1908.8063,1146.4463,1917.76,1142.3438" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="59" x="598" y="1460.7627">ArtifactPack</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="53" x="601" y="1474.5986">+ Metadata</text><!--MD5=[2e43cbb5939e5725847377c2f67dad19]
link exec_metadata to artifact_builder--><path d="M1159,1608.1138 C1159,1642.6038 1159,1694.1038 1159,1730.1038 " fill="none" id="exec_metadata-to-artifact_builder" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="1159,1735.3038,1163,1726.3038,1159,1730.3038,1155,1726.3038,1159,1735.3038" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="81" x="1160" y="1659.2627">Include metadata</text><!--MD5=[cf97f47b7db5c1e788ae146ec3199228]
link chat_svc to state_mgr--><path d="M1991.67,1089.1338 C1997.71,1061.7138 2009.2,1029.1038 2031,1007.3438 C2058.95,979.4437 2080.21,997.0338 2115,978.3438 C2126.02,972.4237 2137.12,965.0138 2147.38,957.4337 " fill="none" id="chat_svc-to-state_mgr" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="2151.42,954.4038,2141.82,956.6037,2147.42,957.4038,2146.62,963.0037,2151.42,954.4038" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="75" x="2032" y="1022.2627">Check approval</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="46" x="2046.5" y="1036.0986">required?</text><!--MD5=[69dedf3e993b39b77d59316a930488fc]
link state_mgr to chat_svc--><path d="M2179.2,954.5638 C2165.87,982.7938 2143.51,1020.4038 2112,1041.3438 C2096.17,1051.8638 2086.65,1040.1938 2070,1049.3438 C2053.6,1058.3538 2038.54,1071.6738 2025.81,1085.3238 " fill="none" id="state_mgr-to-chat_svc" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="2022.28,1089.1838,2031.306,1085.2427,2025.6547,1085.4944,2025.4031,1079.8432,2022.28,1089.1838" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="112" x="2147" y="1019.7627">Set waiting_for_human</text><text fill="#000000" font-family="sans-serif" font-size="15" font-weight="bold" lengthAdjust="spacing" textLength="29" x="2188.5" y="1037.751">true</text><!--MD5=[de7e775e680aa93fb3f9995b60856c10]
link state_mgr to sqlite--><path d="M2256.08,950.9137 C2277.95,961.2538 2303.05,971.6737 2327,978.3438 C2434.34,1008.2137 2465.47,993.2938 2576,1007.3438 C2790.07,1034.5538 3538,924.0438 3538,1139.8438 C3538,1139.8438 3538,1139.8438 3538,1773.8438 C3538,1986.0538 3499.53,2059.4738 3355,2214.8438 C3333.66,2237.7838 3324.12,2240.2938 3295,2251.8438 C3278.55,2258.3638 3271.11,2250.6438 3256,2259.8438 C3235.65,2272.2338 3217.94,2290.9538 3203.73,2309.5438 " fill="none" id="state_mgr-to-sqlite" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="3200.57,2313.7538,3209.17,2308.9538,3203.57,2309.7538,3202.77,2304.1538,3200.57,2313.7538" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="79" x="3539" y="1652.2627">Save case state</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="69" x="3544" y="1666.0986">(ONLY writer)</text><!--MD5=[387592a9ca6bc6293c3631b5b7d92b8e]
link artifact_builder to case_svc--><path d="M1221.63,1763.8338 C1384.9,1742.8338 1815.27,1686.5338 1878,1668.8438 C1934.07,1653.0338 1994.5,1626.4238 2038.76,1604.9837 " fill="none" id="artifact_builder-to-case_svc" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="2043.26,1602.7938,2033.4168,1603.1279,2038.7625,1604.9783,2036.912,1610.3239,2043.26,1602.7938" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="87" x="1955" y="1659.2627">Save ArtifactPack</text><!--MD5=[8ece7f81910c558db007f6fdd8614a0f]
link case_svc to sqlite--><path d="M2164.73,1574.8838 C2365.7,1587.1938 2999.75,1631.1538 3059,1698.8438 C3102.33,1748.3338 3076.83,1783.5338 3059,1846.8438 C3049.53,1880.4438 3027.47,1880.2438 3018,1913.8438 C3005.71,1957.4837 3009.12,1971.3938 3018,2015.8438 C3039.57,2123.7738 3094.61,2239.9138 3131.14,2309.0638 " fill="none" id="case_svc-to-sqlite" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="3133.52,2313.5538,3132.8471,2303.7279,3131.1819,2309.1341,3125.7757,2307.4689,3133.52,2313.5538" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="76" x="3032.5" y="1982.7627">Persist artifacts</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="103" x="3019" y="1996.5986">+ execution metadata</text><!--MD5=[8ece7f81910c558db007f6fdd8614a0f]
link case_svc to sqlite--><path d="M2164.75,1573.9938 C2331.92,1581.6538 2796.2,1605.4938 2945,1639.8438 C3056.48,1665.5738 3166,1657.4338 3166,1771.8438 C3166,1771.8438 3166,1771.8438 3166,2136.8438 C3166,2194.9838 3166,2261.2238 3166,2308.4338 " fill="none" id="case_svc-to-sqlite-1" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="3166,2313.5238,3170,2304.5238,3166,2308.5238,3162,2304.5238,3166,2313.5238" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="108" x="3167" y="1989.7627">Persist ChatMessages</text><!--MD5=[f96841440943ccfa736e628a52342689]
link chat_svc to conv_mgr--><path d="M2052.29,1178.9538 C2069.17,1190.9338 2085.89,1205.5338 2098,1222.3438 C2114.68,1245.4938 2124.34,1275.9238 2129.87,1301.2438 " fill="none" id="chat_svc-to-conv_mgr" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="2130.92,1306.2338,2132.9589,1296.5982,2129.8792,1301.3433,2125.1341,1298.2636,2130.92,1306.2338" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="56" x="2125" y="1234.7627">Get context</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="78" x="2114" y="1248.5986">Save messages</text><!--MD5=[275641cc2b450cb6700da9f1306a5461]
link conv_mgr to case_svc--><path d="M2130.36,1395.5938 C2124.53,1434.0638 2116.09,1489.6638 2110.34,1527.5338 " fill="none" id="conv_mgr-to-case_svc" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="2109.59,1532.5237,2114.8832,1524.2182,2110.3331,1527.5793,2106.972,1523.0292,2109.59,1532.5237" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="111" x="2122" y="1467.7627">Query/Save messages</text><!--MD5=[e176f8c830ee7164b0452616077be7c3]
link ingest_svc to doc_ingest--><path d="M2217.2,1163.4038 C2270.38,1183.0238 2345.65,1215.6038 2402,1259.3438 C2422.34,1275.1338 2441,1297.1938 2454.75,1315.5838 " fill="none" id="ingest_svc-to-doc_ingest" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="2457.78,1319.6838,2455.6405,1310.0701,2454.8052,1315.665,2449.2104,1314.8297,2457.78,1319.6838" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="54" x="2391" y="1241.7627">Documents</text><!--MD5=[ad0ea54048dcacdd93f8cab8289cb31b]
link ingest_svc to data_ingest--><path d="M2177.74,1172.0838 C2210.12,1210.1338 2265.59,1275.3238 2299.6,1315.2938 " fill="none" id="ingest_svc-to-data_ingest" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="2303.23,1319.5638,2300.451,1310.1151,2299.9926,1315.7533,2294.3543,1315.295,2303.23,1319.5638" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="75" x="2241" y="1241.7627">Structured data</text><!--MD5=[ff3530129096d5d30530c227192a89ca]
link doc_ingest to vector_store--><path d="M2478,1382.1038 C2478,1424.1238 2478,1502.5037 2478,1569.3438 C2478,1569.3438 2478,1569.3438 2478,1985.8438 C2478,2025.4638 2491.16,2039.6338 2473,2074.8438 C2466.13,2088.1637 2454.85,2099.5138 2443.09,2108.6538 " fill="none" id="doc_ingest-to-vector_store" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="2439.09,2111.6638,2448.6862,2109.4473,2443.0848,2108.6569,2443.8752,2103.0555,2439.09,2111.6638" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="70" x="2479" y="1770.7627">Embed &amp; store</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="35" x="2496.5" y="1784.5986">chunks</text><!--MD5=[821ca48bacb5330347de1515fdfba385]
link data_ingest to sqlite--><path d="M2354.98,1381.9838 C2368.04,1395.2238 2384.93,1409.6838 2403,1418.3438 C2591.02,1508.4438 3329,1360.8438 3329,1569.3438 C3329,1569.3438 3329,1569.3438 3329,2136.8438 C3329,2157.1338 3262.38,2247.3138 3214.33,2309.7338 " fill="none" id="data_ingest-to-sqlite" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="3211.19,2313.8038,3219.8389,2309.0924,3214.231,2309.8348,3213.4886,2304.2269,3211.19,2313.8038" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="79" x="3330" y="1889.2627">Validate &amp; insert</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="38" x="3350.5" y="1903.0986">records</text><!--MD5=[3c1d0493cc36ce2cbe4bc53743a6725e]
link doc_ingest to files--><path d="M2512.39,1381.9238 C2529.93,1395.4838 2552.31,1410.2438 2575,1418.3438 C2731.97,1474.3538 3196.76,1375.3738 3322,1485.3438 C3570.74,1703.7537 3418.83,1891.9038 3426,2222.8438 C3426.28,2235.7338 3430.15,2239.6438 3426,2251.8438 C3414.92,2284.4138 3390.97,2315.0338 3370.29,2337.1238 " fill="none" id="doc_ingest-to-files" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="3366.74,2340.8638,3375.8364,2337.0881,3370.1815,2337.2366,3370.033,2331.5817,3366.74,2340.8638" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="63" x="3459" y="1896.2627">Store original</text><!--MD5=[8045d37b54a169d6cedb2683a81e19cc]
link task_llm to llm--><path d="M1732.77,2151.1638 C1552.94,2193.2038 1027.93,2315.9538 850.43,2357.4538 " fill="none" id="task_llm-to-llm" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="845.54,2358.5938,855.2106,2360.4593,850.411,2357.4653,853.405,2352.6657,845.54,2358.5938" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="67" x="1451.5" y="2235.2627">Narration only</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="146" x="1412" y="2249.0986">(after rules/retrieval/analytics)</text><!--MD5=[309b8d07722bd08f6b0ec7dd1a19f921]
link router to llm--><path d="M2048.36,702.1338 C1712.18,706.9938 665.99,727.6138 532,797.3438 C472.37,828.3738 438,848.6238 438,915.8438 C438,915.8438 438,915.8438 438,2136.8438 C438,2275.9438 630.52,2337.4838 731.21,2360.1638 " fill="none" id="router-to-llm" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="736.23,2361.2738,728.312,2355.4166,731.3491,2360.1891,726.5766,2363.2261,736.23,2361.2738" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="87" x="448.5" y="1568.2627">LLM Classification</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="106" x="439" y="1582.0986">(primary, JSON mode)</text><!--MD5=[ab65b1da1d35171d40c933fa0b490861]
link task_rules to GMN111--><path d="M1838.03,1601.3538 C1856.72,1613.0638 1879.54,1625.2337 1902,1631.8438 C1933.81,1641.2038 2017.91,1637.6838 2051,1639.8438 C2391.73,1662.1138 2491.81,1594.7238 2817,1698.8438 C2827.86,1702.3238 2838.78,1706.9438 2849.36,1712.1838 " fill="none" id="task_rules-GMN111" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><!--MD5=[9e6fd0a3f423e0aa519248b87fd3ae3a]
link state_mgr to GMN114--><path d="M2233.41,879.1538 C2261.81,854.7238 2302.41,825.0738 2344.5,811.8438 C2430.32,784.8638 2528.45,819.6238 2599.17,856.2037 " fill="none" id="state_mgr-GMN114" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><!--MD5=[411e2e62d003d0346bae11258fcb214e]
link GMN117 to artifact_builder--><path d="M2607.96,1698.6138 C2587.07,1684.9338 2564,1672.6738 2540.5,1665.3438 C2369.31,1611.9338 1912.07,1648.7838 1733.5,1665.3438 C1545.32,1682.7938 1326.87,1731.7537 1221.8,1757.1438 " fill="none" id="GMN117-artifact_builder" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><!--MD5=[8b9cc03d0a75b54d0795c7b65c402606]
link conv_mgr to GMN120--><path d="M2170.97,1306.2038 C2196,1277.2238 2232.82,1241.9538 2274.5,1225.8438 C2382.28,1184.1738 2425.15,1188.4738 2534.5,1225.8438 C2569.22,1237.7138 2602.27,1260.4138 2629.32,1283.2538 " fill="none" id="conv_mgr-GMN120" style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/><rect fill="#DDDDDD" height="235.375" rx="5" ry="5" style="stroke:#000000;stroke-width:1.0;" width="208" x="3396" y="2460.8438"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="30" x="3405" y="2479.2627">Color</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="95" x="3441" y="2479.2627">Component Type</text><rect fill="#FFEBEE" height="13.8359" style="stroke:none;stroke-width:1.0;" width="36" x="3402" y="2481.6797"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="0" x="3405" y="2493.0986"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="63" x="3441" y="2493.0986">Human Actor</text><rect fill="#E3F2FD" height="13.8359" style="stroke:none;stroke-width:1.0;" width="36" x="3402" y="2495.5156"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="0" x="3405" y="2506.9346"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="95" x="3441" y="2506.9346">Frontend (Streamlit)</text><rect fill="#E8F5E9" height="13.8359" style="stroke:none;stroke-width:1.0;" width="36" x="3402" y="2509.3516"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="0" x="3405" y="2520.7705"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="90" x="3441" y="2520.7705">Backend (FastAPI)</text><rect fill="#FFF3E0" height="13.8359" style="stroke:none;stroke-width:1.0;" width="36" x="3402" y="2523.1875"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="0" x="3405" y="2534.6064"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="126" x="3441" y="2534.6064">Supervisor (Orchestrator)</text><rect fill="#F3E5F5" height="13.8359" style="stroke:none;stroke-width:1.0;" width="36" x="3402" y="2537.0234"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="0" x="3405" y="2548.4424"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="89" x="3441" y="2548.4424">Official Agents (7)</text><rect fill="#FFF9C4" height="13.8359" style="stroke:none;stroke-width:1.0;" width="36" x="3402" y="2550.8594"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="0" x="3405" y="2562.2783"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="104" x="3441" y="2562.2783">Task Execution Layer</text><rect fill="#ECEFF1" height="13.8359" style="stroke:none;stroke-width:1.0;" width="36" x="3402" y="2564.6953"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="0" x="3405" y="2576.1143"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="88" x="3441" y="2576.1143">Data / Persistence</text><rect fill="#E8E8E8" height="13.8359" style="stroke:none;stroke-width:1.0;" width="36" x="3402" y="2578.5313"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="0" x="3405" y="2589.9502"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="78" x="3441" y="2589.9502">External System</text><line style="stroke:#000000;stroke-width:1.0;" x1="3402" x2="3570" y1="2467.8438" y2="2467.8438"/><line style="stroke:#000000;stroke-width:1.0;" x1="3402" x2="3570" y1="2481.6797" y2="2481.6797"/><line style="stroke:#000000;stroke-width:1.0;" x1="3402" x2="3570" y1="2495.5156" y2="2495.5156"/><line style="stroke:#000000;stroke-width:1.0;" x1="3402" x2="3570" y1="2509.3516" y2="2509.3516"/><line style="stroke:#000000;stroke-width:1.0;" x1="3402" x2="3570" y1="2523.1875" y2="2523.1875"/><line style="stroke:#000000;stroke-width:1.0;" x1="3402" x2="3570" y1="2537.0234" y2="2537.0234"/><line style="stroke:#000000;stroke-width:1.0;" x1="3402" x2="3570" y1="2550.8594" y2="2550.8594"/><line style="stroke:#000000;stroke-width:1.0;" x1="3402" x2="3570" y1="2564.6953" y2="2564.6953"/><line style="stroke:#000000;stroke-width:1.0;" x1="3402" x2="3570" y1="2578.5313" y2="2578.5313"/><line style="stroke:#000000;stroke-width:1.0;" x1="3402" x2="3570" y1="2592.3672" y2="2592.3672"/><line style="stroke:#000000;stroke-width:1.0;" x1="3402" x2="3402" y1="2467.8438" y2="2592.3672"/><line style="stroke:#000000;stroke-width:1.0;" x1="3438" x2="3438" y1="2467.8438" y2="2592.3672"/><line style="stroke:#000000;stroke-width:1.0;" x1="3570" x2="3570" y1="2467.8438" y2="2592.3672"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="0" x="3405" y="2605.7861"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="126" x="3402" y="2619.6221">Key Governance Rules:</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="167" x="3402" y="2633.458">1. Supervisor is ONLY state writer</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="194" x="3402" y="2647.2939">2. Rules → Retrieval → Analytics → LLM</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="176" x="3402" y="2661.1299">3. Hybrid classification (rules + LLM)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="196" x="3402" y="2674.9658">4. Stage advancement requires approval</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="177" x="3402" y="2688.8018">5. All artifacts tracked with metadata</text><!--MD5=[4552ee17f8fd1cb0c4902576efc5173c]
@startuml Agentic_Sourcing_Architecture

' =============================================================================
' AGENTIC SOURCING COPILOT — SYSTEM ARCHITECTURE DIAGRAM
' =============================================================================
' 
' Purpose: Visual representation of the human-in-the-loop, multi-agent 
'          decision-support system for procurement sourcing.
'
' Version: Current (2025) - Reflects actual implementation
'
' Key Features:
'   • LLM-First Intent Classification with Structured Output
'   • 7 Official Agents with Task Execution Hierarchy
'   • Artifact System with Execution Metadata
'   • Two-Level Intent Classification (UserGoal + WorkType)
'   • Supervisor-only State Changes
'   • Conversation Memory with Cost-Aware Context Management (optional)
'   • Aggressive Caching (500 entries, 80%+ hit rate expected)
'
' To render: Use PlantUML extension in VS Code/Cursor (Alt+D) or online at
'            http://www.plantuml.com/plantuml
' =============================================================================

title Agentic Sourcing Copilot - Enterprise Architecture\n//Human-in-the-Loop Multi-Agent Decision Support System//\n\n**Current Implementation** — LLM-First Classification & Artifact System

skinparam backgroundColor #FEFEFE
skinparam defaultFontSize 11
skinparam roundcorner 10
skinparam shadowing true

skinparam rectangle {
    BackgroundColor<<human>> #FFEBEE
    BorderColor<<human>> #C62828
    BorderThickness 2
    BackgroundColor<<frontend>> #E3F2FD
    BorderColor<<frontend>> #1976D2
    BorderThickness 2
    BackgroundColor<<backend>> #E8F5E9
    BorderColor<<backend>> #388E3C
    BorderThickness 2
    BackgroundColor<<supervisor>> #FFF3E0
    BorderColor<<supervisor>> #F57C00
    BorderThickness 3
    BackgroundColor<<agent>> #F3E5F5
    BorderColor<<agent>> #7B1FA2
    BorderThickness 2
    BackgroundColor<<task>> #FFF9C4
    BorderColor<<task>> #F9A825
    BorderThickness 2
    BackgroundColor<<data>> #ECEFF1
    BorderColor<<data>> #546E7A
    BorderThickness 2
    BackgroundColor<<external>> #E8E8E8
    BorderColor<<external>> #999999
    BorderThickness 2
}

' ============== EXTERNAL ACTORS ==============
rectangle "👤 **Procurement Officer**\n(Human Decision-Maker)" as human <<human>>

rectangle "🤖 **OpenAI GPT-4**\n(LLM Provider)" as llm <<external>>

' ============== FRONTEND CONTAINER ==============
package "**FRONTEND** - Streamlit UI" <<frontend>> {
    rectangle "📊 **Case Dashboard**\nCase list, metrics,\nfiltering, status view" as dashboard
    rectangle "💬 **Case Copilot**\nChat interface,\nartifact display,\naudit trail" as copilot
    rectangle "📁 **Knowledge Management**\nDocument upload,\ndata ingestion" as knowledge
    rectangle "🔌 **API Client**\nHTTP/REST communication\nor Direct imports" as api_client
}

' ============== BACKEND CONTAINER ==============
package "**BACKEND** - FastAPI Server" <<backend>> {
    
    rectangle "🌐 **REST API**\n/cases, /chat, /decisions,\n/ingest, /health" as api
    
    package "**Services Layer**" {
        rectangle "💬 **Chat Service**\nMessage processing,\nintent handling,\nresponse formatting\n+ Conversation memory\n+ Cost estimation" as chat_svc
        rectangle "💾 **Conversation Context\nManager**\nContext retrieval,\nmessage storage,\ncost-aware selection" as conv_mgr
        rectangle "📋 **Case Service**\nCase CRUD,\nartifact management,\nstate persistence" as case_svc
        rectangle "📥 **Ingestion Service**\nUpload orchestration,\nvalidation" as ingest_svc
    }
    
    package "**SUPERVISOR** - Central Orchestrator" <<supervisor>> {
        rectangle "🧠 **Intent Router**\nLLM-First Classification:\n• LLM with structured output (primary)\n• Aggressive caching (500 entries)\n• Rule fallback (errors only)\n• Two-level (UserGoal+WorkType)" as router
        rectangle "📊 **State Manager**\nDTP stage tracking,\nvalidation, transitions,\nONLY state writer" as state_mgr
        rectangle "📋 **Action Planner**\nAgent selection,\ntask planning" as planner
    }
    
    package "**7 OFFICIAL AGENTS**" <<agent>> {
        rectangle "📡 **Sourcing Signal**\n(DTP-01)\nSignal detection,\nurgency scoring" as signal_agent
        rectangle "⭐ **Supplier Scoring**\n(DTP-02)\nEvaluation, ranking,\neligibility checks" as supplier_agent
        rectangle "📝 **RFx Draft**\n(DTP-03)\nRFI/RFP/RFQ assembly" as rfx_agent
        rectangle "🤝 **Negotiation Support**\n(DTP-04)\nLeverage analysis,\ntargets, playbook" as negotiation_agent
        rectangle "📄 **Contract Support**\n(DTP-05)\nTerm extraction,\nvalidation, handoff" as contract_agent
        rectangle "🚀 **Implementation**\n(DTP-06)\nRollout planning,\nvalue capture" as impl_agent
    }
    
    package "**TASK EXECUTION LAYER**" <<task>> {
        rectangle "1️⃣ **Rules**\nDeterministic checks,\npolicy validation" as task_rules
        rectangle "2️⃣ **Retrieval**\nChromaDB + SQLite\nquery, grounding" as task_retrieval
        rectangle "3️⃣ **Analytics**\nScoring, normalization,\ncomparison, ranking" as task_analytics
        rectangle "4️⃣ **LLM**\nNarration, summaries\n(last resort only)" as task_llm
    }
    
    package "**ARTIFACT SYSTEM**" {
        rectangle "📦 **Artifact Builder**\nPack creation,\nverification status,\ngrounding references" as artifact_builder
        rectangle "📊 **Execution Metadata**\nTokens, costs,\ntask details,\nretrieval sources" as exec_metadata
    }
    
    package "**RAG LAYER**" {
        rectangle "🔍 **Retriever**\nSemantic search,\nmetadata filter" as retriever
        rectangle "📦 **Vector Store**\nChromaDB wrapper" as vector_store
    }
    
    package "**INGESTION LAYER**" {
        rectangle "📄 **Doc Ingest**\nPDF, DOCX, TXT\n→ chunks → embed" as doc_ingest
        rectangle "📊 **Data Ingest**\nCSV, Excel\n→ validate → store" as data_ingest
    }
}

' ============== DATA LAYER ==============
package "**DATA LAYER** - Persistence" <<data>> {
    rectangle "🗄️ **SQLite**\nData Lake\n• Cases\n• ArtifactPacks\n• ChatMessages\n• Execution Metadata\n• Suppliers, Spend, SLAs" as sqlite
    rectangle "🧲 **ChromaDB**\nVector Store\n• Document embeddings\n• Semantic search" as chromadb
    rectangle "📁 **Files**\nUploaded documents\nSynthetic test data" as files
}

' ============== FLOW ARROWS ==============

' Human Interaction
human - -> copilot : "Asks questions,\nApproves/Rejects"
copilot - -> human : "Recommendations,\nEvidence, Pending\nApproval"

human - -> dashboard : "Views cases,\nselects case"
human - -> knowledge : "Uploads documents\n& data files"

' Frontend to Backend
dashboard - -> api_client
copilot - -> api_client
knowledge - -> api_client
api_client - -> api : "REST API calls\nor Direct imports"

' API to Services
api - -> case_svc : "Case CRUD"
api - -> chat_svc : "Chat messages"
api - -> ingest_svc : "File uploads"

' Chat Service to Supervisor
chat_svc - -> router : "User message\n+ context"
router - -> state_mgr : "Validates\nDTP stage"
router - -> planner : "Two-level intent\n→ Action Plan"
planner - -> chat_svc : "Agent + Tasks"

' Supervisor to Agents
chat_svc - -> signal_agent : "DTP-01:\nSignal detection"
chat_svc - -> supplier_agent : "DTP-02:\nSupplier scoring"
chat_svc - -> rfx_agent : "DTP-03:\nRFx drafting"
chat_svc - -> negotiation_agent : "DTP-04:\nNegotiation support"
chat_svc - -> contract_agent : "DTP-05:\nContract extraction"
chat_svc - -> impl_agent : "DTP-06:\nImplementation planning"

' Agents execute Tasks (in order)
signal_agent - -> task_rules : "1. Rules"
supplier_agent - -> task_rules : "1. Rules"
rfx_agent - -> task_rules : "1. Rules"
negotiation_agent - -> task_rules : "1. Rules"
contract_agent - -> task_rules : "1. Rules"
impl_agent - -> task_rules : "1. Rules"

task_rules - -> task_retrieval : "2. Retrieval"
task_retrieval - -> task_analytics : "3. Analytics"
task_analytics - -> task_llm : "4. LLM\n(if needed)"

' Agents use RAG
task_retrieval - -> retriever : "Query documents"
retriever - -> vector_store : "Semantic search"
vector_store - -> chromadb : "Vector query"

' Agents query structured data
task_retrieval - -> sqlite : "Query structured data\n(Suppliers, Spend, SLAs)"

' Agents return ArtifactPacks
signal_agent - -> artifact_builder : "Build ArtifactPack"
supplier_agent - -> artifact_builder : "Build ArtifactPack"
rfx_agent - -> artifact_builder : "Build ArtifactPack"
negotiation_agent - -> artifact_builder : "Build ArtifactPack"
contract_agent - -> artifact_builder : "Build ArtifactPack"
impl_agent - -> artifact_builder : "Build ArtifactPack"

' Execution Metadata tracking
signal_agent - -> exec_metadata : "Track execution"
supplier_agent - -> exec_metadata : "Track execution"
rfx_agent - -> exec_metadata : "Track execution"
negotiation_agent - -> exec_metadata : "Track execution"
contract_agent - -> exec_metadata : "Track execution"
impl_agent - -> exec_metadata : "Track execution"

' Artifacts return to Chat Service
artifact_builder - -> chat_svc : "ArtifactPack\n+ Metadata"
exec_metadata - -> artifact_builder : "Include metadata"

' Human-in-the-Loop Checkpoint
chat_svc - -> state_mgr : "Check approval\nrequired?"
state_mgr - -> chat_svc : "Set waiting_for_human\n= true"

' State updates (ONLY Supervisor/State Manager)
state_mgr - -> sqlite : "Save case state\n(ONLY writer)"

' Artifact persistence
artifact_builder - -> case_svc : "Save ArtifactPack"
case_svc - -> sqlite : "Persist artifacts\n+ execution metadata"

' Conversation Memory (optional, if enabled)
chat_svc - -> conv_mgr : "Get context\nSave messages"
conv_mgr - -> case_svc : "Query/Save messages"
case_svc - -> sqlite : "Persist ChatMessages"

' Ingestion Flow
ingest_svc - -> doc_ingest : "Documents"
ingest_svc - -> data_ingest : "Structured data"
doc_ingest - -> vector_store : "Embed & store\nchunks"
data_ingest - -> sqlite : "Validate & insert\nrecords"
doc_ingest - -> files : "Store original"

' LLM Calls (only via task_llm)
task_llm - -> llm : "Narration only\n(after rules/retrieval/analytics)"

' Hybrid Classification LLM call
router - -> llm : "LLM Classification\n(primary, JSON mode)"

' ============== NOTES ==============
note right of router
    **LLM-First Intent Classification**
    ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
    1. LLM classification (primary path)
    2. Structured output (Pydantic schema)
    3. Aggressive caching (500 entries)
    4. Two-level: UserGoal + WorkType
    5. Context-aware (DTP stage, conversation history)
    6. Rule fallback (errors only)
    7. Few-shot examples in prompt
end note

note bottom of task_rules
    **Task Execution Hierarchy**
    ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
    All agents follow same order:
    1. Rules (deterministic)
    2. Retrieval (ground in data)
    3. Analytics (calculate)
    4. LLM (narrate only)
    ⚠️ Never skip steps
end note

note right of state_mgr
    **Supervisor Governance**
    ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
    • ONLY component that writes
      case state
    • Validates all transitions
    • Enforces human approval
    • Blocks invalid DTP jumps
    • Logs all changes
end note

note left of artifact_builder
    **Artifact System**
    ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
    • ArtifactPacks with multiple
      artifacts
    • Verification status (VERIFIED/
      PARTIAL/UNVERIFIED)
    • Grounding references
    • Execution metadata (tokens,
      costs, task details)
    • Full audit trail
end note

note right of conv_mgr
    **Conversation Memory**
    (Optional Feature)
    ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
    • Enabled via env var
    • Cost-aware context selection
    • Pre-execution cost estimation
    • Backward compatible (disabled
      by default)
    • Messages persist in database
end note

note top of human
    **Human-in-the-Loop**
    ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
    ✅ Approve → Advance stage
    ✏️ Edit → Modify & resubmit
    ❌ Reject → Stay at stage
    
    AI advises, Human decides
end note

' ============== LEGEND ==============
legend right
    |= Color |= Component Type |
    | <#FFEBEE> | Human Actor |
    | <#E3F2FD> | Frontend (Streamlit) |
    | <#E8F5E9> | Backend (FastAPI) |
    | <#FFF3E0> | Supervisor (Orchestrator) |
    | <#F3E5F5> | Official Agents (7) |
    | <#FFF9C4> | Task Execution Layer |
    | <#ECEFF1> | Data / Persistence |
    | <#E8E8E8> | External System |
    
    **Key Governance Rules:**
    1. Supervisor is ONLY state writer
    2. Rules → Retrieval → Analytics → LLM
    3. Hybrid classification (rules + LLM)
    4. Stage advancement requires approval
    5. All artifacts tracked with metadata
endlegend

@enduml

@startuml Agentic_Sourcing_Architecture


title Agentic Sourcing Copilot - Enterprise Architecture\n//Human-in-the-Loop Multi-Agent Decision Support System//\n\n**Current Implementation** — LLM-First Classification & Artifact System

skinparam backgroundColor #FEFEFE
skinparam defaultFontSize 11
skinparam roundcorner 10
skinparam shadowing true

skinparam rectangle {
    BackgroundColor<<human>> #FFEBEE
    BorderColor<<human>> #C62828
    BorderThickness 2
    BackgroundColor<<frontend>> #E3F2FD
    BorderColor<<frontend>> #1976D2
    BorderThickness 2
    BackgroundColor<<backend>> #E8F5E9
    BorderColor<<backend>> #388E3C
    BorderThickness 2
    BackgroundColor<<supervisor>> #FFF3E0
    BorderColor<<supervisor>> #F57C00
    BorderThickness 3
    BackgroundColor<<agent>> #F3E5F5
    BorderColor<<agent>> #7B1FA2
    BorderThickness 2
    BackgroundColor<<task>> #FFF9C4
    BorderColor<<task>> #F9A825
    BorderThickness 2
    BackgroundColor<<data>> #ECEFF1
    BorderColor<<data>> #546E7A
    BorderThickness 2
    BackgroundColor<<external>> #E8E8E8
    BorderColor<<external>> #999999
    BorderThickness 2
}

rectangle "👤 **Procurement Officer**\n(Human Decision-Maker)" as human <<human>>

rectangle "🤖 **OpenAI GPT-4**\n(LLM Provider)" as llm <<external>>

package "**FRONTEND** - Streamlit UI" <<frontend>> {
    rectangle "📊 **Case Dashboard**\nCase list, metrics,\nfiltering, status view" as dashboard
    rectangle "💬 **Case Copilot**\nChat interface,\nartifact display,\naudit trail" as copilot
    rectangle "📁 **Knowledge Management**\nDocument upload,\ndata ingestion" as knowledge
    rectangle "🔌 **API Client**\nHTTP/REST communication\nor Direct imports" as api_client
}

package "**BACKEND** - FastAPI Server" <<backend>> {
    
    rectangle "🌐 **REST API**\n/cases, /chat, /decisions,\n/ingest, /health" as api
    
    package "**Services Layer**" {
        rectangle "💬 **Chat Service**\nMessage processing,\nintent handling,\nresponse formatting\n+ Conversation memory\n+ Cost estimation" as chat_svc
        rectangle "💾 **Conversation Context\nManager**\nContext retrieval,\nmessage storage,\ncost-aware selection" as conv_mgr
        rectangle "📋 **Case Service**\nCase CRUD,\nartifact management,\nstate persistence" as case_svc
        rectangle "📥 **Ingestion Service**\nUpload orchestration,\nvalidation" as ingest_svc
    }
    
    package "**SUPERVISOR** - Central Orchestrator" <<supervisor>> {
        rectangle "🧠 **Intent Router**\nLLM-First Classification:\n• LLM with structured output (primary)\n• Aggressive caching (500 entries)\n• Rule fallback (errors only)\n• Two-level (UserGoal+WorkType)" as router
        rectangle "📊 **State Manager**\nDTP stage tracking,\nvalidation, transitions,\nONLY state writer" as state_mgr
        rectangle "📋 **Action Planner**\nAgent selection,\ntask planning" as planner
    }
    
    package "**7 OFFICIAL AGENTS**" <<agent>> {
        rectangle "📡 **Sourcing Signal**\n(DTP-01)\nSignal detection,\nurgency scoring" as signal_agent
        rectangle "⭐ **Supplier Scoring**\n(DTP-02)\nEvaluation, ranking,\neligibility checks" as supplier_agent
        rectangle "📝 **RFx Draft**\n(DTP-03)\nRFI/RFP/RFQ assembly" as rfx_agent
        rectangle "🤝 **Negotiation Support**\n(DTP-04)\nLeverage analysis,\ntargets, playbook" as negotiation_agent
        rectangle "📄 **Contract Support**\n(DTP-05)\nTerm extraction,\nvalidation, handoff" as contract_agent
        rectangle "🚀 **Implementation**\n(DTP-06)\nRollout planning,\nvalue capture" as impl_agent
    }
    
    package "**TASK EXECUTION LAYER**" <<task>> {
        rectangle "1️⃣ **Rules**\nDeterministic checks,\npolicy validation" as task_rules
        rectangle "2️⃣ **Retrieval**\nChromaDB + SQLite\nquery, grounding" as task_retrieval
        rectangle "3️⃣ **Analytics**\nScoring, normalization,\ncomparison, ranking" as task_analytics
        rectangle "4️⃣ **LLM**\nNarration, summaries\n(last resort only)" as task_llm
    }
    
    package "**ARTIFACT SYSTEM**" {
        rectangle "📦 **Artifact Builder**\nPack creation,\nverification status,\ngrounding references" as artifact_builder
        rectangle "📊 **Execution Metadata**\nTokens, costs,\ntask details,\nretrieval sources" as exec_metadata
    }
    
    package "**RAG LAYER**" {
        rectangle "🔍 **Retriever**\nSemantic search,\nmetadata filter" as retriever
        rectangle "📦 **Vector Store**\nChromaDB wrapper" as vector_store
    }
    
    package "**INGESTION LAYER**" {
        rectangle "📄 **Doc Ingest**\nPDF, DOCX, TXT\n→ chunks → embed" as doc_ingest
        rectangle "📊 **Data Ingest**\nCSV, Excel\n→ validate → store" as data_ingest
    }
}

package "**DATA LAYER** - Persistence" <<data>> {
    rectangle "🗄️ **SQLite**\nData Lake\n• Cases\n• ArtifactPacks\n• ChatMessages\n• Execution Metadata\n• Suppliers, Spend, SLAs" as sqlite
    rectangle "🧲 **ChromaDB**\nVector Store\n• Document embeddings\n• Semantic search" as chromadb
    rectangle "📁 **Files**\nUploaded documents\nSynthetic test data" as files
}


human - -> copilot : "Asks questions,\nApproves/Rejects"
copilot - -> human : "Recommendations,\nEvidence, Pending\nApproval"

human - -> dashboard : "Views cases,\nselects case"
human - -> knowledge : "Uploads documents\n& data files"

dashboard - -> api_client
copilot - -> api_client
knowledge - -> api_client
api_client - -> api : "REST API calls\nor Direct imports"

api - -> case_svc : "Case CRUD"
api - -> chat_svc : "Chat messages"
api - -> ingest_svc : "File uploads"

chat_svc - -> router : "User message\n+ context"
router - -> state_mgr : "Validates\nDTP stage"
router - -> planner : "Two-level intent\n→ Action Plan"
planner - -> chat_svc : "Agent + Tasks"

chat_svc - -> signal_agent : "DTP-01:\nSignal detection"
chat_svc - -> supplier_agent : "DTP-02:\nSupplier scoring"
chat_svc - -> rfx_agent : "DTP-03:\nRFx drafting"
chat_svc - -> negotiation_agent : "DTP-04:\nNegotiation support"
chat_svc - -> contract_agent : "DTP-05:\nContract extraction"
chat_svc - -> impl_agent : "DTP-06:\nImplementation planning"

signal_agent - -> task_rules : "1. Rules"
supplier_agent - -> task_rules : "1. Rules"
rfx_agent - -> task_rules : "1. Rules"
negotiation_agent - -> task_rules : "1. Rules"
contract_agent - -> task_rules : "1. Rules"
impl_agent - -> task_rules : "1. Rules"

task_rules - -> task_retrieval : "2. Retrieval"
task_retrieval - -> task_analytics : "3. Analytics"
task_analytics - -> task_llm : "4. LLM\n(if needed)"

task_retrieval - -> retriever : "Query documents"
retriever - -> vector_store : "Semantic search"
vector_store - -> chromadb : "Vector query"

task_retrieval - -> sqlite : "Query structured data\n(Suppliers, Spend, SLAs)"

signal_agent - -> artifact_builder : "Build ArtifactPack"
supplier_agent - -> artifact_builder : "Build ArtifactPack"
rfx_agent - -> artifact_builder : "Build ArtifactPack"
negotiation_agent - -> artifact_builder : "Build ArtifactPack"
contract_agent - -> artifact_builder : "Build ArtifactPack"
impl_agent - -> artifact_builder : "Build ArtifactPack"

signal_agent - -> exec_metadata : "Track execution"
supplier_agent - -> exec_metadata : "Track execution"
rfx_agent - -> exec_metadata : "Track execution"
negotiation_agent - -> exec_metadata : "Track execution"
contract_agent - -> exec_metadata : "Track execution"
impl_agent - -> exec_metadata : "Track execution"

artifact_builder - -> chat_svc : "ArtifactPack\n+ Metadata"
exec_metadata - -> artifact_builder : "Include metadata"

chat_svc - -> state_mgr : "Check approval\nrequired?"
state_mgr - -> chat_svc : "Set waiting_for_human\n= true"

state_mgr - -> sqlite : "Save case state\n(ONLY writer)"

artifact_builder - -> case_svc : "Save ArtifactPack"
case_svc - -> sqlite : "Persist artifacts\n+ execution metadata"

chat_svc - -> conv_mgr : "Get context\nSave messages"
conv_mgr - -> case_svc : "Query/Save messages"
case_svc - -> sqlite : "Persist ChatMessages"

ingest_svc - -> doc_ingest : "Documents"
ingest_svc - -> data_ingest : "Structured data"
doc_ingest - -> vector_store : "Embed & store\nchunks"
data_ingest - -> sqlite : "Validate & insert\nrecords"
doc_ingest - -> files : "Store original"

task_llm - -> llm : "Narration only\n(after rules/retrieval/analytics)"

router - -> llm : "LLM Classification\n(primary, JSON mode)"

note right of router
    **LLM-First Intent Classification**
    ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
    1. LLM classification (primary path)
    2. Structured output (Pydantic schema)
    3. Aggressive caching (500 entries)
    4. Two-level: UserGoal + WorkType
    5. Context-aware (DTP stage, conversation history)
    6. Rule fallback (errors only)
    7. Few-shot examples in prompt
end note

note bottom of task_rules
    **Task Execution Hierarchy**
    ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
    All agents follow same order:
    1. Rules (deterministic)
    2. Retrieval (ground in data)
    3. Analytics (calculate)
    4. LLM (narrate only)
    ⚠️ Never skip steps
end note

note right of state_mgr
    **Supervisor Governance**
    ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
    • ONLY component that writes
      case state
    • Validates all transitions
    • Enforces human approval
    • Blocks invalid DTP jumps
    • Logs all changes
end note

note left of artifact_builder
    **Artifact System**
    ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
    • ArtifactPacks with multiple
      artifacts
    • Verification status (VERIFIED/
      PARTIAL/UNVERIFIED)
    • Grounding references
    • Execution metadata (tokens,
      costs, task details)
    • Full audit trail
end note

note right of conv_mgr
    **Conversation Memory**
    (Optional Feature)
    ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
    • Enabled via env var
    • Cost-aware context selection
    • Pre-execution cost estimation
    • Backward compatible (disabled
      by default)
    • Messages persist in database
end note

note top of human
    **Human-in-the-Loop**
    ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
    ✅ Approve → Advance stage
    ✏️ Edit → Modify & resubmit
    ❌ Reject → Stay at stage
    
    AI advises, Human decides
end note

legend right
    |= Color |= Component Type |
    | <#FFEBEE> | Human Actor |
    | <#E3F2FD> | Frontend (Streamlit) |
    | <#E8F5E9> | Backend (FastAPI) |
    | <#FFF3E0> | Supervisor (Orchestrator) |
    | <#F3E5F5> | Official Agents (7) |
    | <#FFF9C4> | Task Execution Layer |
    | <#ECEFF1> | Data / Persistence |
    | <#E8E8E8> | External System |
    
    **Key Governance Rules:**
    1. Supervisor is ONLY state writer
    2. Rules → Retrieval → Analytics → LLM
    3. Hybrid classification (rules + LLM)
    4. Stage advancement requires approval
    5. All artifacts tracked with metadata
endlegend

@enduml

PlantUML version 1.2021.00(Sun Jan 10 05:25:05 EST 2021)
(MIT source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: Cp1252
Language: en
Country: US
--></g></svg>